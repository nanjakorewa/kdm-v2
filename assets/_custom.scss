/* =====================================================================
   K_DM Book - Modern & Trustworthy polish (Hugo Book 互換)
   - 配色/角丸/影を抑えめにして“安心感”を演出
   - 透明性メタ（更新日/読了時間/編集リンク）用スタイルも同梱
   - ダークモードは BookTheme='auto' の data-theme に追従
   ===================================================================== */

/* 1) Design tokens (CSS variables) ------------------------------------ */
:root{
  --bg:#ffffff;
  --surface:#fcfcfd;
  --elev:#f6f7f9;
  --text:#1f2937;
  --muted:#6b7280;
  --link:#0a66c2;
  --link-hover:#084e96;
  --brand:#1d4ed8;
  --border:#e5e7eb;
  --ring:#60a5fa;

  --radius:8px;                         /* 丸みの基準を控えめに */
  --shadow-sm:0 1px 6px rgba(0,0,0,.05);
  --shadow-md:0 6px 18px rgba(0,0,0,.08);

  --fs-0: clamp(.98rem, .92rem + .3vw, 1.05rem);
  --fs-1: clamp(1.1rem, 1.0rem + .6vw, 1.25rem);
  --fs-2: clamp(1.35rem, 1.1rem + 1.1vw, 1.65rem);
  --fs-3: clamp(1.8rem, 1.4rem + 1.8vw, 2.3rem);
}

/* ダークは data-theme="dark" が付与される（hugo-bookの仕様） */
@media (prefers-color-scheme: dark){
  :root{
    --bg:#0b0f14;
    --surface:#0f141b;
    --elev:#111826;
    --text:#e5e7eb;
    --muted:#a1a1aa;
    --link:#5aa7e6;
    --link-hover:#87c2f1;
    --brand:#4f7ff2;
    --border:#1f2937;
    --ring:#38bdf8;
  }
}

/* 2) Base -------------------------------------------------------------- */
html{ scroll-behavior:smooth; }
body{
  font-size:var(--fs-0);
  line-height:1.8;
  color:var(--text);
  background:var(--bg);
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}
::selection{ background: color-mix(in oklab, var(--link) 26%, transparent); }

/* 本文リンク */
.book-article a{
  color:var(--link);
  text-decoration-thickness:.08em;
  text-underline-offset:.18em;
  transition: color .2s ease, background-color .2s ease, border-color .2s ease;
}
.book-article a:hover{ color:var(--link-hover); }

/* 見出しのサイズ感（抑制気味で品よく） */
.book-article h1{ font-size:var(--fs-3); letter-spacing:-.01em; }
.book-article h2{ font-size:var(--fs-2); margin-top:2.2rem; }
.book-article h3{ font-size:1.2rem; margin-top:1.6rem; }

/* 3) Header（半透明・固定）------------------------------------------ */
.book-header{
  position:sticky; top:0; z-index:30;
  backdrop-filter:saturate(140%) blur(8px);
  background: color-mix(in oklab, var(--surface) 82%, transparent);
  border-bottom:1px solid var(--border);
}
.book-header h3{ margin:.6rem 0; }

/* 4) Sidebar ------------------------------------------------------------ */
.book-menu{
  width:280px;
  border-right:1px solid var(--border);
  background:var(--surface);
}
.book-menu-content{ padding-bottom:2rem; }
.book-brand a{ color:inherit; }
.book-menu a:hover{ color:var(--link); }
.book-menu .active > a,
.book-menu .toc a.active{
  background: color-mix(in oklab, var(--brand) 10%, transparent);
  color:var(--brand);
  border-radius:8px;
}
.book-languages > li > label{
  border:1px solid var(--border);
  border-radius:12px;              /* ピルを抑えめに */
  padding:.35rem .6rem;
}
.book-languages ul{
  border:1px solid var(--border);
  border-radius:10px;
  box-shadow:var(--shadow-sm);
  background:var(--surface);
}
/* 検索 */
.book-search input{
  border:1px solid var(--border);
  border-radius:12px;              /* 9999px → 12px */
  padding:.55rem .9rem;
  background:var(--surface);
  color:var(--text);
  transition: box-shadow .2s ease, border-color .2s ease;
}
.book-search input:focus{
  outline:none;
  border-color:var(--ring);
  box-shadow:0 0 0 3px color-mix(in oklab, var(--ring) 30%, transparent);
}
@media (max-width:48rem){ .book-menu{ width:80vw; } }

/* 5) Page container ----------------------------------------------------- */
.book-page{ max-width: $body-max-width; }
.book-page main{ padding-top:.5rem; }

/* 6) Media（画像/YouTube）--------------------------------------------- */
.book-page img,
.book-page .video-container,
.youtube-embed{
  display:block;
  margin:2rem auto;
  border-radius:var(--radius);
  box-shadow:var(--shadow-md);
  max-width:100%;
  height:auto;
}

/* 7) Callouts / イントロボックス -------------------------------------- */
.pagetop-box{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:1rem 1.25rem;
  box-shadow:var(--shadow-sm);
}
.pagetop-box b{ color:var(--text); }

/* 旧テーマの notices 互換（info/warning/note/tip/ref） */
div.notices{ margin:1.6rem 0; }
div.notices p{
  background:var(--surface);
  color:var(--text);
  border:1px solid var(--border);
  border-top-width:4px;
  border-radius:var(--radius);
  padding:.9rem 1rem;
  box-shadow:var(--shadow-sm);
}
div.notices.info p    { border-top-color:#f59e0b; }
div.notices.warning p { border-top-color:#ef4444; }
div.notices.note p    { border-top-color:#38bdf8; }
div.notices.tip p     { border-top-color:#22c55e; }
div.notices.ref p     { border-top-color:#06b6d4; }

/* Summary callout */
.summary-box{
  margin:1.2rem 0;
  padding:.8rem 1rem;
  border-left:4px solid var(--brand);
  border-radius:var(--radius);
  background: color-mix(in oklab, var(--brand) 12%, var(--surface) 88%);
  box-shadow:var(--shadow-sm);
  color:var(--text);
}
.summary-box__title{
  display:block;
  margin-bottom:.4rem;
  font-weight:600;
}
.summary-box__content{
  margin:0;
}
@media (prefers-color-scheme: dark){
  .summary-box{
    background: color-mix(in oklab, var(--brand) 26%, rgba(11,15,20,.75));
    border-left-color: color-mix(in oklab, var(--brand) 70%, rgba(11,15,20,.25));
  }
}

/* 8) Code（Chroma出力）------------------------------------------------- */
.highlight pre{
  background:#0b1220 !important;
  color:#e5e7eb;
  border-radius:var(--radius);
  padding:1rem 1.1rem;
  box-shadow:var(--shadow-sm);
  position:relative;
}
.highlight pre code{ background:transparent; }

/* クリックコピーのヒント */
.highlight pre:hover::after{
  content:"Copy";
  position:absolute; right:.6rem; top:.5rem;
  font-size:.8rem; color:#cbd5e1; opacity:.85;
}

/* 行内コード */
.book-article p > code,
.book-article li > code,
.book-article table code{
  background: color-mix(in oklab, var(--link) 12%, var(--bg));
  color:var(--text);
  border:1px solid color-mix(in oklab, var(--link) 18%, var(--border));
  border-radius:6px;
  padding:.12em .35em;
}

/* 9) Tables ------------------------------------------------------------- */
.book-article table{
  width:100%;
  border:1px solid var(--border);
  border-collapse:separate;
  border-spacing:0;
  background:var(--surface);
  box-shadow:var(--shadow-sm);
  border-radius:var(--radius);
  overflow:hidden;
}
.book-article th, .book-article td{
  padding:.7rem;
  border-bottom:1px solid var(--border);
}
.book-article th{
  background:var(--elev);
  text-align:left;
  font-weight:600;
}
.book-article tr:hover td{
  background: color-mix(in oklab, var(--elev) 55%, transparent);
}

/* 10) TOC パネル -------------------------------------------------------- */
.book-toc{
  border-left:1px solid var(--border);
  background:var(--surface);
}
.book-toc-content{ padding-top:.75rem; }
#TableOfContents a{ color:inherit; }
#TableOfContents a:hover{ color:var(--link); }
#TableOfContents li{ margin:.25rem 0; }

/* 11) Footer ------------------------------------------------------------ */
.book-footer{ background:transparent; border-top:1px solid var(--border); }
.book-footer .book-icon{ filter:grayscale(.2); }

/* 12) アクセシビリティ -------------------------------------------------- */
:focus-visible{ outline:2px solid var(--ring); outline-offset:3px; }

/* 13) ダーク微調整 ------------------------------------------------------ */
[data-theme="dark"] .book-header{
  background: color-mix(in oklab, var(--surface) 70%, transparent);
}
[data-theme="dark"] .book-article table{ background:#0f141b; }
[data-theme="dark"] .book-article th{ background:#111826; }
[data-theme="dark"] .pagetop-box,
[data-theme="dark"] .book-menu,
[data-theme="dark"] .book-toc{
  background:var(--surface);
}

/* 14) 外部リンクを控えめに可視化 -------------------------------------- */
.book-article a[target="_blank"]::after{
  content:"↗"; font-size:.85em; margin-left:.15em; opacity:.6;
}
.book-article a[target="_blank"]:hover::after{ opacity:.9; }

/* 15) メタバー（更新日/読了時間/編集リンク）-------------------------- */
/* 使い方：layouts/partials/docs/inject/content-before.html に
   meta-bar の HTML を追加済みである前提 */
.meta-bar{
  display:flex; flex-wrap:wrap; gap:.5rem 1rem; align-items:center;
  margin:1rem 0 1.25rem; padding:.6rem .9rem;
  background:var(--surface); border:1px solid var(--border);
  border-radius:var(--radius); box-shadow:var(--shadow-sm);
}
.meta-bar .breadcrumbs{ font-size:.95rem; color:var(--muted); }
.meta-bar .breadcrumbs a{ color:inherit; }
.meta-bar .breadcrumbs .sep{ margin:0 .35rem; color:var(--border); }
.meta-bar .meta{ margin-left:auto; font-size:.92rem; color:var(--muted); }
.meta-item a{ color:var(--link); }
@media (max-width:48rem){
  .meta-bar{ flex-direction:column; align-items:flex-start; }
  .meta-bar .meta{ margin-left:0; }
}

/* 16) 信頼フッター（任意）--------------------------------------------- */
/* 使い方：layouts/partials/docs/inject/footer.html に trust-footer を追加 */
.trust-footer{
  margin-top:1.25rem; padding-top:.75rem;
  border-top:1px solid var(--border);
  color:var(--muted);
  display:flex; flex-wrap:wrap; gap:.5rem; align-items:center;
}
.trust-footer a{
  color:inherit;
  text-decoration:underline;
  text-underline-offset:.15em;
}
.trust-footer .dot{ color:var(--border); }

/* --- YouTube: 安定版埋め込み（カード風） --- */
.yt { margin: 2rem 0; }
.yt-cap { margin-top:.5rem; font-size:.95rem; color:var(--muted); }

.yt-frame{
  width:100%;
  min-height: 400px;
  border-radius: var(--radius);
  overflow:hidden;
  box-shadow: var(--shadow-md);
  background:#000;                 /* 読み込み前の背景 */
}
.yt-frame iframe{
  width:100%;
  height:100%;
  display:block;
  border:0;
}

/* --- ワイド/フル幅オプション（Sass互換・安全版） --- */
.yt--wide,
.yt--full{
  width: calc(100vw - 2rem);                  /* ビューポート基準で広げる */
  max-width: var(--embed-max, 1100px);        /* 上限キャップ */
  margin-left: 50%;
  transform: translateX(-50%);                /* 中央寄せ */
}

.yt--full { --embed-max: 1400px; }

/* --- Share bar ------------------------------------------------------- */
.share--floating{
  position:fixed;
  bottom:1.4rem;
  right:1.2rem;
  display:flex;
  flex-direction:column;
  gap:.75rem;
  z-index:80;
  pointer-events:none;
}
.share__btn{
  pointer-events:auto;
  width:3rem;
  height:3rem;
  border-radius:999px;
  display:flex;
  align-items:center;
  justify-content:center;
  border:1px solid color-mix(in oklab, var(--border) 70%, transparent);
  background: color-mix(in oklab, var(--surface) 90%, transparent);
  color:var(--text);
  box-shadow:var(--shadow-md);
  transition: transform .2s ease, box-shadow .2s ease, background .2s ease, color .2s ease, border-color .2s ease;
}
.share__btn i{
  font-size:1.25rem;
  line-height:1;
}
.share__btn:hover,
.share__btn:focus-visible{
  transform: translateY(-2px);
  box-shadow:0 10px 24px rgba(0,0,0,.18);
}
.share__btn:focus-visible{
  outline:none;
  border-color:var(--ring);
  box-shadow:0 0 0 3px color-mix(in oklab, var(--ring) 28%, transparent);
}
.share__btn--x{
  background:#000;
  border-color:#000;
  color:#fff;
}
.share__btn--facebook{
  background:#1877F2;
  border-color:#1877F2;
  color:#fff;
}
.share__btn--copy{
  background: color-mix(in oklab, var(--surface) 85%, #fff 15%);
  border-color: color-mix(in oklab, var(--border) 80%, transparent);
}
.share__btn--copy.share__btn--copied{
  background: color-mix(in oklab, var(--link) 20%, #fff 80%);
  border-color: var(--link);
  color: var(--link);
}
.share__btn--native{
  background: var(--brand);
  border-color: var(--brand);
  color:#fff;
}
.share__btn.is-hidden{
  display:none !important;
}
.sr-only{
  position:absolute;
  width:1px;
  height:1px;
  padding:0;
  margin:-1px;
  overflow:hidden;
  clip:rect(0,0,0,0);
  border:0;
  white-space:nowrap;
}
@media (max-width:48rem){
  .share--floating{
  bottom:1rem;
  right:.9rem;
  gap:.6rem;
  }
  .share__btn{
    width:2.75rem;
    height:2.75rem;
  }
}
@media (min-width:62rem){
  .book-toc-content{
    position:relative;
    display:flex;
    flex-direction:column;
    min-height:100vh;
    padding-bottom:4rem;
  }
  .share--floating.share--in-toc{
    position:sticky;
    bottom:auto;
    top:calc(100vh - 4.5rem);
    right:auto;
    margin-left:auto;
    margin-top:auto;
  }
  .share--floating.share--in-toc .share__btn{
    width:2.75rem;
    height:2.75rem;
  }
}
@media print{
  .share--floating{ display:none !important; }
}

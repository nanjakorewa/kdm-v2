{{- $alt := .Text | plainify -}}
{{- $title := .Title -}}
{{- $src := .Destination -}}

{{/* Page Bundle ���̑��Ή摜��D�悵�čœK���i������΂��̂܂܁j */}}
{{- $res := .Page.Resources.GetMatch (printf "**%s" $src) -}}
{{- if and $res (eq $res.MediaType.Type "image") -}}
  {{- $sizes := slice 360 720 960 1200 -}}
  {{- $srcset := slice -}}
  {{- range $sizes -}}
    {{- $img := $res.Resize (printf "%dx webp" .) -}}
    {{- $srcset = $srcset | append (printf "%s %dw" ($img.RelPermalink | absURL) .) -}}
  {{- end -}}
  {{- $main := $res.Resize "960x webp" -}}
  <img
    src="{{ $main.RelPermalink | absURL }}"
    srcset="{{ delimit $srcset ", " }}"
    sizes="(max-width: 800px) 100vw, 800px"
    alt="{{ $alt }}"
    {{ with $title }}title="{{ . }}"{{ end }}
    width="{{ $main.Width }}" height="{{ $main.Height }}"
    loading="lazy" decoding="async" fetchpriority="low">
{{- else -}}
  {{/* static/ �z���Ȃǂ̐�΃p�X�摜 */}}
  {{- $lang := or .Page.Lang "ja" -}}
  {{- $langMap := dict "ja" "_ja" "en" "_en" "es" "_es" "id" "_id" -}}
  {{- $langSuffix := default "_ja" (index $langMap $lang) -}}
  {{- $ext := path.Ext $src -}}
  {{- $base := cond (ne $ext "") (strings.TrimSuffix $src $ext) $src -}}
  {{- $baseNoSuffix := cond (strings.HasSuffix $base $langSuffix) (strings.TrimSuffix $base $langSuffix) $base -}}
  {{- if eq $baseNoSuffix "" -}}
    {{- $baseNoSuffix = $base -}}
  {{- end -}}
  {{- $candidates := slice $src -}}
  {{- $candidates = $candidates | append (printf "%s%s.png" $baseNoSuffix $langSuffix) -}}
  {{- $candidates = $candidates | append (printf "%s.png" $baseNoSuffix) -}}
  {{- range $candidates -}}
    {{- $candidateRel := strings.TrimPrefix . "/" -}}
    {{- if fileExists (printf "static/%s" $candidateRel) -}}
      {{- $src = . -}}
      {{- break -}}
    {{- end -}}
  {{- end -}}
  <img
    src="{{ $src | absURL }}"
    alt="{{ $alt }}"
    {{ with $title }}title="{{ . }}"{{ end }}
    loading="lazy" decoding="async">
{{- end -}}

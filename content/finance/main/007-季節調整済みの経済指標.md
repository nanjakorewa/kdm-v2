---
title: 季節調整
weight: 10
pre: "<b>7.1.10 </b>"
not_use_colab: true
title_suffix: "について仕組みを理解する"
---

{{% youtube "UtZvKKSr9rY" %}}

# 経済データの季節調整
総務省統計局の公開している「[家計調査（家計収支編）　時系列データ（二人以上の世帯）](https://www.stat.go.jp/data/kakei/longtime/index.html)」のデータを分析します。

参考文献：[経済産業省 鉱工業指数(生産・出荷・在庫、生産能力・稼働率)、製造工業生産予測指数 季節調整手法](https://www.meti.go.jp/statistics/tyo/iip/riyou-4.pdf)

### データの前処理
配布されているデータには空白のセルや複数にまたがるセルが含まれていて、このまま処理するのは難しいです。
必要な範囲だけを切り取り数値に変換した `new_df` を用意します。


```python
import pandas as pd

df = pd.read_csv("./支出金額.csv", encoding="cp932")
df.head(15)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>二人以上の世帯_支出金額[円]</th>
      <th>Unnamed: 1</th>
      <th>Unnamed: 2</th>
      <th>Unnamed: 3</th>
      <th>Unnamed: 4</th>
      <th>Unnamed: 5</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>...</th>
      <th>260</th>
      <th>261</th>
      <th>262</th>
      <th>263</th>
      <th>264</th>
      <th>265</th>
      <th>266</th>
      <th>267</th>
      <th>268</th>
      <th>269</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2000年</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2022年</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>(平成12年)</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>(令和4年)</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>表側連番</td>
      <td>階層</td>
      <td>大分類</td>
      <td>中分類</td>
      <td>小分類</td>
      <td>品目分類</td>
      <td>1月</td>
      <td>2月</td>
      <td>3月</td>
      <td>4月</td>
      <td>...</td>
      <td>8月</td>
      <td>9月</td>
      <td>10月</td>
      <td>11月</td>
      <td>12月</td>
      <td>1月</td>
      <td>2月</td>
      <td>3月</td>
      <td>4月</td>
      <td>5月</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>世帯数分布(抽出率調整)</td>
      <td>10000</td>
      <td>10000</td>
      <td>10000</td>
      <td>10000</td>
      <td>...</td>
      <td>10000</td>
      <td>10000</td>
      <td>10000</td>
      <td>10000</td>
      <td>10000</td>
      <td>10000</td>
      <td>10000</td>
      <td>10000</td>
      <td>10000</td>
      <td>10000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>集計世帯数</td>
      <td>7887</td>
      <td>7942</td>
      <td>7934</td>
      <td>7922</td>
      <td>...</td>
      <td>7397</td>
      <td>7378</td>
      <td>7407</td>
      <td>7411</td>
      <td>7416</td>
      <td>7353</td>
      <td>7315</td>
      <td>7369</td>
      <td>7357</td>
      <td>7391</td>
    </tr>
    <tr>
      <th>5</th>
      <td>3</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>世帯人員(人)</td>
      <td>3.32</td>
      <td>3.32</td>
      <td>3.32</td>
      <td>3.32</td>
      <td>...</td>
      <td>2.93</td>
      <td>2.93</td>
      <td>2.93</td>
      <td>2.93</td>
      <td>2.92</td>
      <td>2.92</td>
      <td>2.92</td>
      <td>2.92</td>
      <td>2.91</td>
      <td>2.91</td>
    </tr>
    <tr>
      <th>6</th>
      <td>4</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>18歳未満人員(人)</td>
      <td>0.74</td>
      <td>0.75</td>
      <td>0.75</td>
      <td>0.75</td>
      <td>...</td>
      <td>0.55</td>
      <td>0.56</td>
      <td>0.56</td>
      <td>0.55</td>
      <td>0.55</td>
      <td>0.55</td>
      <td>0.55</td>
      <td>0.54</td>
      <td>0.55</td>
      <td>0.55</td>
    </tr>
    <tr>
      <th>7</th>
      <td>5</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>65歳以上人員(人)</td>
      <td>0.52</td>
      <td>0.53</td>
      <td>0.53</td>
      <td>0.52</td>
      <td>...</td>
      <td>0.85</td>
      <td>0.83</td>
      <td>0.84</td>
      <td>0.84</td>
      <td>0.85</td>
      <td>0.84</td>
      <td>0.85</td>
      <td>0.84</td>
      <td>0.84</td>
      <td>0.84</td>
    </tr>
    <tr>
      <th>8</th>
      <td>6</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>うち無職者人員(人)</td>
      <td>0.41</td>
      <td>0.41</td>
      <td>0.41</td>
      <td>0.41</td>
      <td>...</td>
      <td>0.68</td>
      <td>0.67</td>
      <td>0.68</td>
      <td>0.67</td>
      <td>0.67</td>
      <td>0.67</td>
      <td>0.68</td>
      <td>0.66</td>
      <td>0.67</td>
      <td>0.67</td>
    </tr>
    <tr>
      <th>9</th>
      <td>7</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>有業人員(人)</td>
      <td>1.51</td>
      <td>1.51</td>
      <td>1.51</td>
      <td>1.52</td>
      <td>...</td>
      <td>1.33</td>
      <td>1.33</td>
      <td>1.33</td>
      <td>1.34</td>
      <td>1.33</td>
      <td>1.33</td>
      <td>1.31</td>
      <td>1.33</td>
      <td>1.33</td>
      <td>1.34</td>
    </tr>
    <tr>
      <th>10</th>
      <td>8</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>世帯主の年齢(歳)</td>
      <td>52.4</td>
      <td>52.6</td>
      <td>52.7</td>
      <td>52.6</td>
      <td>...</td>
      <td>60.1</td>
      <td>59.9</td>
      <td>59.9</td>
      <td>59.9</td>
      <td>60.2</td>
      <td>60</td>
      <td>60.2</td>
      <td>60.1</td>
      <td>60</td>
      <td>60</td>
    </tr>
    <tr>
      <th>11</th>
      <td>9</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>持家率(％)</td>
      <td>76</td>
      <td>76.3</td>
      <td>76.2</td>
      <td>75.8</td>
      <td>...</td>
      <td>84.1</td>
      <td>84.1</td>
      <td>84.4</td>
      <td>84.4</td>
      <td>84.1</td>
      <td>83.9</td>
      <td>84</td>
      <td>84.4</td>
      <td>85</td>
      <td>84.8</td>
    </tr>
    <tr>
      <th>12</th>
      <td>10</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>家賃・地代を支払っている世帯の割合(％)</td>
      <td>22.1</td>
      <td>22</td>
      <td>22.6</td>
      <td>22.2</td>
      <td>...</td>
      <td>14.9</td>
      <td>14.6</td>
      <td>13.9</td>
      <td>14</td>
      <td>14.8</td>
      <td>14.6</td>
      <td>14.9</td>
      <td>13.8</td>
      <td>13.4</td>
      <td>13.8</td>
    </tr>
    <tr>
      <th>13</th>
      <td>11</td>
      <td>1</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>消費支出</td>
      <td>309621</td>
      <td>290663</td>
      <td>335341</td>
      <td>335276</td>
      <td>...</td>
      <td>266638</td>
      <td>265306</td>
      <td>281996</td>
      <td>277029</td>
      <td>317206</td>
      <td>287801</td>
      <td>257887</td>
      <td>307261</td>
      <td>304510</td>
      <td>287687</td>
    </tr>
    <tr>
      <th>14</th>
      <td>12</td>
      <td>2</td>
      <td>1</td>
      <td>-</td>
      <td>-</td>
      <td>食料</td>
      <td>73580</td>
      <td>73309</td>
      <td>79726</td>
      <td>77344</td>
      <td>...</td>
      <td>81412</td>
      <td>76673</td>
      <td>79543</td>
      <td>78490</td>
      <td>99518</td>
      <td>75974</td>
      <td>71655</td>
      <td>79982</td>
      <td>77014</td>
      <td>82066</td>
    </tr>
  </tbody>
</table>
<p>15 rows × 275 columns</p>
</div>




```python
new_df = pd.DataFrame(
    {
        "日付": pd.date_range(start="2000/1/1", end="2022/5/1", freq="MS"),
        "消費支出": pd.to_numeric(df.iloc[13][6:]),
    }
)
new_df = new_df.set_index("日付")
new_df["消費支出"] = (new_df["消費支出"] / new_df["消費支出"].mean()) * 100.0

new_df.head(10)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>消費支出</th>
    </tr>
    <tr>
      <th>日付</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-01-01</th>
      <td>105.629546</td>
    </tr>
    <tr>
      <th>2000-02-01</th>
      <td>99.161881</td>
    </tr>
    <tr>
      <th>2000-03-01</th>
      <td>114.404119</td>
    </tr>
    <tr>
      <th>2000-04-01</th>
      <td>114.381944</td>
    </tr>
    <tr>
      <th>2000-05-01</th>
      <td>105.269625</td>
    </tr>
    <tr>
      <th>2000-06-01</th>
      <td>101.544867</td>
    </tr>
    <tr>
      <th>2000-07-01</th>
      <td>111.381122</td>
    </tr>
    <tr>
      <th>2000-08-01</th>
      <td>105.756457</td>
    </tr>
    <tr>
      <th>2000-09-01</th>
      <td>101.138548</td>
    </tr>
    <tr>
      <th>2000-10-01</th>
      <td>105.483531</td>
    </tr>
  </tbody>
</table>
</div>



### データをプロットしてみる


```python
import japanize_matplotlib as jm
import matplotlib.pyplot as plt
import seaborn as sns

sns.set(rc={"figure.figsize": (15, 8)})
jm.japanize()
sns.lineplot(data=new_df, x="日付", y="消費支出")
plt.show()
```


    
![png](/images/finance/main/007-%E5%AD%A3%E7%AF%80%E8%AA%BF%E6%95%B4%E6%B8%88%E3%81%BF%E3%81%AE%E7%B5%8C%E6%B8%88%E6%8C%87%E6%A8%99_files/007-%E5%AD%A3%E7%AF%80%E8%AA%BF%E6%95%B4%E6%B8%88%E3%81%BF%E3%81%AE%E7%B5%8C%E6%B8%88%E6%8C%87%E6%A8%99_4_0.png)
    


### 傾向変動を取り除く
人口増加などの要因による長期間にわたる変動傾向。移動平均線を用いたり、最小二乗法による直線・曲線のフィッティングなど、統計データによって手法は異なる。

参考：[numpy.polyfit — NumPy v1.23 Manual](https://numpy.org/doc/stable/reference/generated/numpy.polyfit.html)


```python
import numpy as np

idx = [i for i in range(new_df.shape[0])]

傾向変動の関数の係数 = np.polyfit(idx, new_df["消費支出"], 3)
傾向変動の関数 = np.poly1d(傾向変動の関数の係数)
new_df["傾向変動"] = 傾向変動の関数(idx)
new_df["傾向変動調整分"] = new_df["消費支出"] - 傾向変動の関数(idx) + np.mean(傾向変動の関数(idx))

sns.set(rc={"figure.figsize": (15, 8)})
jm.japanize()
sns.lineplot(data=new_df, x="日付", y="消費支出", label="消費支出")
sns.lineplot(data=new_df, x="日付", y="傾向変動", label="傾向変動")
# sns.lineplot(data=new_df, x="日付", y="傾向変動調整分", label="傾向変動調整分")
plt.show()
```


    
![png](/images/finance/main/007-%E5%AD%A3%E7%AF%80%E8%AA%BF%E6%95%B4%E6%B8%88%E3%81%BF%E3%81%AE%E7%B5%8C%E6%B8%88%E6%8C%87%E6%A8%99_files/007-%E5%AD%A3%E7%AF%80%E8%AA%BF%E6%95%B4%E6%B8%88%E3%81%BF%E3%81%AE%E7%B5%8C%E6%B8%88%E6%8C%87%E6%A8%99_6_0.png)
    


### 循環変動
[キチンサイクル](https://www.smd-am.co.jp/glossary/YST3239/)など、数年周期の変動を指すことが多い。

### 季節変動
一年を周期とした周期的な変動を総称して「季節変動」と呼ぶ。月別平均法・連環比率法など。

#### ①過去の複数年の月別平均値を求める


```python
new_df["月"] = new_df.index.month
季節ごとの平均値 = new_df.groupby("月").mean()["消費支出"]
季節ごとの平均値
```




    月
    1     100.083036
    2      92.102619
    3     107.280556
    4     104.477264
    5      97.832924
    6      94.348753
    7      98.973205
    8      99.165835
    9      95.138160
    10     99.351828
    11     96.230671
    12    114.934402
    Name: 消費支出, dtype: float64



#### ②月別平均値の合計を求める


```python
月別平均値の合計 = 季節ごとの平均値.sum()
print(f"月別平均値の合計 = {月別平均値の合計}")
```

    月別平均値の合計 = 1199.9192545557726


#### ③修正係数を計算する


```python
修正係数 = 1200.0 / 月別平均値の合計
print(f"修正係数 = {修正係数}")
```

    修正係数 = 1.0000672923981517


#### ④月別平均に修正係数を乗じる


```python
修正済みの季節ごとの平均値 = 修正係数 * 季節ごとの平均値
```


```python
# 各月のデータから修正済みの季節ごとの平均値を引いています
new_df["季節変動調整分"] = new_df["消費支出"] - new_df["月"].apply(lambda m: 修正済みの季節ごとの平均値[m])
new_df.to_csv("支出金額_加工済みデータ.csv", encoding="utf-8-sig")

# グラフを作成
sns.set(rc={"figure.figsize": (15, 8)})
jm.japanize()
sns.lineplot(data=new_df, x="日付", y="消費支出", label="消費支出")
sns.lineplot(data=new_df, x="日付", y="傾向変動", label="傾向変動")
sns.lineplot(data=new_df, x="日付", y="季節変動調整分", label="季節変動調整分")
plt.show()
```


    
![png](/images/finance/main/007-%E5%AD%A3%E7%AF%80%E8%AA%BF%E6%95%B4%E6%B8%88%E3%81%BF%E3%81%AE%E7%B5%8C%E6%B8%88%E6%8C%87%E6%A8%99_files/007-%E5%AD%A3%E7%AF%80%E8%AA%BF%E6%95%B4%E6%B8%88%E3%81%BF%E3%81%AE%E7%B5%8C%E6%B8%88%E6%8C%87%E6%A8%99_15_0.png)
    



```python

```

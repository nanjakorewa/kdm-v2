<!DOCTYPE html>
<html lang="ja" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="
  

Prophetがどのようにしてモデルを作成しているのか、もう少し詳細に見てみたいと思います。

Taylor, Sean J., and Benjamin Letham. &ldquo;Forecasting at scale.&rdquo; The American Statistician 72.1 (2018): 37-45.


import numpy as np
import pandas as pd
import random
import seaborn as sns
import matplotlib.pyplot as plt
import japanize_matplotlib
from prophet import Prophet

  実験に使用するデータ
  
  #
  

１年間のデータを用意します。このデータには以下の特徴があります。

2020/1/1 ~ 2020/12/31 の期間のデータ
週ごとに周期的な数値を取る
土日は大きな値をとる
不定期にイベントが発生し、その時は非常に大きな値を取る(horidays_indexに該当する日付を指しています)

date = pd.date_range(&#34;2020-01-01&#34;, periods=365, freq=&#34;D&#34;)
horidays_index = random.sample([i for i in range(365)], 10)
y = [
    np.log(10 &#43; i &#43; 10 * np.cos(i))  # トレンド
    &#43; np.cos(di.weekday() * np.pi / 28) * 3  # 週ごとに周期性あり
    &#43; (di.weekday() in {5, 6}) * 0.5  #       〃
    &#43; (i in horidays_index) * 2  # 祝日だけ数値を増やす
    &#43; np.random.rand() / 10  # ノイズ
    for i, di in enumerate(date)
]

df = pd.DataFrame({&#34;ds&#34;: date, &#34;y&#34;: y})
df.index = date

plt.title(&#34;サンプルデータ&#34;)
sns.lineplot(data=df)
plt.show()
">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="http://localhost:1313/timeseries/forecast/002-prophet-alg/">
  <meta property="og:site_name" content="K_DM Book">
  <meta property="og:title" content="Prophetのモデルの中身">
  <meta property="og:description" content="Prophetがどのようにしてモデルを作成しているのか、もう少し詳細に見てみたいと思います。
Taylor, Sean J., and Benjamin Letham. “Forecasting at scale.” The American Statistician 72.1 (2018): 37-45.
import numpy as np import pandas as pd import random import seaborn as sns import matplotlib.pyplot as plt import japanize_matplotlib from prophet import Prophet 実験に使用するデータ # １年間のデータを用意します。このデータには以下の特徴があります。
2020/1/1 ~ 2020/12/31 の期間のデータ 週ごとに周期的な数値を取る 土日は大きな値をとる 不定期にイベントが発生し、その時は非常に大きな値を取る(horidays_indexに該当する日付を指しています) date = pd.date_range(&#34;2020-01-01&#34;, periods=365, freq=&#34;D&#34;) horidays_index = random.sample([i for i in range(365)], 10) y = [ np.log(10 &#43; i &#43; 10 * np.cos(i)) # トレンド &#43; np.cos(di.weekday() * np.pi / 28) * 3 # 週ごとに周期性あり &#43; (di.weekday() in {5, 6}) * 0.5 # 〃 &#43; (i in horidays_index) * 2 # 祝日だけ数値を増やす &#43; np.random.rand() / 10 # ノイズ for i, di in enumerate(date) ] df = pd.DataFrame({&#34;ds&#34;: date, &#34;y&#34;: y}) df.index = date plt.title(&#34;サンプルデータ&#34;) sns.lineplot(data=df) plt.show()">
  <meta property="og:locale" content="ja">
  <meta property="og:type" content="article">
    <meta property="article:section" content="timeseries">
<title>Prophetのモデルの中身 | K_DM Book</title>
<link rel="icon" href="/favicon.png" >
<link rel="manifest" href="/manifest.json">
<link rel="canonical" href="http://localhost:1313/timeseries/forecast/002-prophet-alg/">
<link rel="stylesheet" href="/book.min.5c80a20e1f11b0e9dc4cae70ce44083860ffa999a7bf8ab5dab38664fde8a418.css" integrity="sha256-XICiDh8RsOncTK5wzkQIOGD/qZmnv4q12rOGZP3opBg=" crossorigin="anonymous">
  <script defer src="/fuse.min.js"></script>
  <script defer src="/ja.search.min.58d3a47dfc146864a58893dc5fc3dea0c3290cbd2695f142a0697316f5b64e98.js" integrity="sha256-WNOkffwUaGSliJPcX8PeoMMpDL0mlfFCoGlzFvW2Tpg=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr" class="book-kind-page book-type-timeseries">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    
<aside class="book-menu">
  <div class="book-menu-content">
    
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>K_DM Book</span>
  </a>
</h2>


<div class="book-search hidden">
  <input type="text" id="book-search-input" placeholder="検索" aria-label="検索" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>



  



  
    
  
    
  
    
  



<ul class="book-languages">
  <li>
    <input type="checkbox" id="languages" class="toggle" />
    <label for="languages" class="flex">
      <a role="button" class="flex flex-auto">
        <img src="/svg/translate.svg" class="book-icon" alt="Languages" />
        <span>日本語</span>
      </a>
    </label>

    <ul>
      
      <li>
        <a href="/en/">
          <span>English</span>
        </a>
      </li>
      
      <li>
        <a href="/es/">
          <span>Español</span>
        </a>
      </li>
      
      <li>
        <a href="/id/">
          <span>Indonesia</span>
        </a>
      </li>
      
    </ul>
  </li>
</ul>














  
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/basic/regression/" class="">線形回帰</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/basic/regression/linear_regression/" class="">最小二乗法</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/regression/ridge_and_lasso/" class="">リッジ回帰・ラッソ回帰</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/regression/robust_regression/" class="">外れ値と頑健性</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/regression/regressionanalysis/" class="">残差の分析</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/classification/" class="">線形分類</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/basic/classification/logistic_regression/" class="">ロジスティック回帰</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/classification/linear_discriminant_analysis/" class="">判別分析</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/tree/" class="">決定木</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/basic/tree/decision_tree_classifier/" class="">決定木(分類)</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/tree/decision_tree_regressor/" class="">決定木(回帰)</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/tree/parameter/" class="">決定木のパラメータ</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/tree/rulefit/" class="">RuleFit</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/ensemble/" class="">アンサンブル</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/basic/ensemble/randomforest/" class="">ランダムフォレスト</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/ensemble/stucking/" class="">スタッキング</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/ensemble/adaboost_classification/" class="">Adaboost(分類)</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/ensemble/adaboost_regression/" class="">Adaboost(回帰)</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/ensemble/gradient_boosting1/" class="">勾配ブースティング</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/ensemble/gradient_boosting2/" class="">勾配ブースティングの可視化</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/clustering/" class="">クラスタリング</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/basic/clustering/k-means1/" class="">k-means</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/clustering/k-means2/" class="">k-means&#43;&#43;</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/clustering/x-means/" class="">X-means</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/dimensionality_reduction/" class="">次元削減</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/basic/dimensionality_reduction/pca/" class="">PCA</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/dimensionality_reduction/svd/" class="">SVD</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/dimensionality_reduction/lda/" class="">LDA</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/dimensionality_reduction/kernel-pca/" class="">Kernel-PCA</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/feature_selection/" class="">特徴選択</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/basic/feature_selection/boruta/" class="">Boruta</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/timeseries/" class="">時系列</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/basic/timeseries/prophet/" class="">Prophetを使ってみる</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/anomaly/" class="">異常検知</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/basic/anomaly/adtk1/" class="">異常検知①</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/anomaly/adtk2/" class="">異常検知②</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>














</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>



  </div>
</aside>
 

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>Prophetのモデルの中身</h3>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#実験に使用するデータ">実験に使用するデータ</a></li>
    <li><a href="#トレンドの指定">トレンドの指定</a>
      <ul>
        <li><a href="#growthlinear">growth=&ldquo;linear&rdquo;</a></li>
        <li><a href="#growthflat">growth=&ldquo;flat&rdquo;</a></li>
      </ul>
    </li>
    <li><a href="#季節変化の指定">季節変化の指定</a>
      <ul>
        <li><a href="#seasonalityが全てfalse">seasonalityが全てFalse</a></li>
        <li><a href="#weekly_seasonalitytrue">weekly_seasonality=True</a></li>
        <li><a href="#yearly_seasonalitytrue">yearly_seasonality=True</a></li>
      </ul>
    </li>
    <li><a href="#休日イベント効果">休日・イベント効果</a>
      <ul>
        <li><a href="#休日イベントの指定なしholidaysnone">休日・イベントの指定なし(<code>holidays=None</code>)</a></li>
        <li><a href="#休日イベントの指定あり">休日・イベントの指定あり</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article">
<div class="youtube-embed">
  <iframe loading="lazy" class="youtube-video" src="https://www.youtube.com/embed/JIjETRPKpT4" title="YouTube video player" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</div>
<p>Prophetがどのようにしてモデルを作成しているのか、もう少し詳細に見てみたいと思います。</p>

<div class="notices ref" ><p>Taylor, Sean J., and Benjamin Letham. &ldquo;Forecasting at scale.&rdquo; The American Statistician 72.1 (2018): 37-45.</p>
</div>

<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> pandas <span style="color:#66d9ef">as</span> pd
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> random
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> seaborn <span style="color:#66d9ef">as</span> sns
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> japanize_matplotlib
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> prophet <span style="color:#f92672">import</span> Prophet
</span></span></code></pre></div><h2 id="実験に使用するデータ">
  実験に使用するデータ
  
  <a class="anchor" href="#%e5%ae%9f%e9%a8%93%e3%81%ab%e4%bd%bf%e7%94%a8%e3%81%99%e3%82%8b%e3%83%87%e3%83%bc%e3%82%bf">#</a>
  
</h2>
<p>１年間のデータを用意します。このデータには以下の特徴があります。</p>
<ul>
<li>2020/1/1 ~ 2020/12/31 の期間のデータ</li>
<li>週ごとに周期的な数値を取る</li>
<li>土日は大きな値をとる</li>
<li>不定期にイベントが発生し、その時は非常に大きな値を取る(<code>horidays_index</code>に該当する日付を指しています)</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>date <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>date_range(<span style="color:#e6db74">&#34;2020-01-01&#34;</span>, periods<span style="color:#f92672">=</span><span style="color:#ae81ff">365</span>, freq<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;D&#34;</span>)
</span></span><span style="display:flex;"><span>horidays_index <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>sample([i <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">365</span>)], <span style="color:#ae81ff">10</span>)
</span></span><span style="display:flex;"><span>y <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    np<span style="color:#f92672">.</span>log(<span style="color:#ae81ff">10</span> <span style="color:#f92672">+</span> i <span style="color:#f92672">+</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">*</span> np<span style="color:#f92672">.</span>cos(i))  <span style="color:#75715e"># トレンド</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">+</span> np<span style="color:#f92672">.</span>cos(di<span style="color:#f92672">.</span>weekday() <span style="color:#f92672">*</span> np<span style="color:#f92672">.</span>pi <span style="color:#f92672">/</span> <span style="color:#ae81ff">28</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">3</span>  <span style="color:#75715e"># 週ごとに周期性あり</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">+</span> (di<span style="color:#f92672">.</span>weekday() <span style="color:#f92672">in</span> {<span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>}) <span style="color:#f92672">*</span> <span style="color:#ae81ff">0.5</span>  <span style="color:#75715e">#       〃</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">+</span> (i <span style="color:#f92672">in</span> horidays_index) <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>  <span style="color:#75715e"># 祝日だけ数値を増やす</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">+</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>rand() <span style="color:#f92672">/</span> <span style="color:#ae81ff">10</span>  <span style="color:#75715e"># ノイズ</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i, di <span style="color:#f92672">in</span> enumerate(date)
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame({<span style="color:#e6db74">&#34;ds&#34;</span>: date, <span style="color:#e6db74">&#34;y&#34;</span>: y})
</span></span><span style="display:flex;"><span>df<span style="color:#f92672">.</span>index <span style="color:#f92672">=</span> date
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#34;サンプルデータ&#34;</span>)
</span></span><span style="display:flex;"><span>sns<span style="color:#f92672">.</span>lineplot(data<span style="color:#f92672">=</span>df)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img src="/images/timeseries/forecast/002-Prophet-alg_files/002-Prophet-alg_5_0.png" alt="png" /></p>
<h2 id="トレンドの指定">
  トレンドの指定
  
  <a class="anchor" href="#%e3%83%88%e3%83%ac%e3%83%b3%e3%83%89%e3%81%ae%e6%8c%87%e5%ae%9a">#</a>
  
</h2>
<h3 id="growthlinear">
  growth=&ldquo;linear&rdquo;
  
  <a class="anchor" href="#growthlinear">#</a>
  
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># モデルを作成</span>
</span></span><span style="display:flex;"><span>m <span style="color:#f92672">=</span> Prophet(
</span></span><span style="display:flex;"><span>    yearly_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>    weekly_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>    daily_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>    growth<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;linear&#34;</span>,
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>m<span style="color:#f92672">.</span>fit(df)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 将来を予測</span>
</span></span><span style="display:flex;"><span>future <span style="color:#f92672">=</span> m<span style="color:#f92672">.</span>make_future_dataframe(periods<span style="color:#f92672">=</span><span style="color:#ae81ff">90</span>)
</span></span><span style="display:flex;"><span>forecast <span style="color:#f92672">=</span> m<span style="color:#f92672">.</span>predict(future)
</span></span><span style="display:flex;"><span>fig <span style="color:#f92672">=</span> m<span style="color:#f92672">.</span>plot(forecast)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>axvspan(<span style="color:#ae81ff">18627</span>, <span style="color:#ae81ff">18627</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">90</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;coral&#34;</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.4</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;予測期間&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><pre><code>Initial log joint probability = -2.99674
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
      99       1040.17   0.000845008       95.4398      0.3546      0.3546      128   
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
     166       1045.08   8.28451e-05       66.0092   1.087e-06       0.001      252  LS failed, Hessian reset 
     184       1045.09   1.58284e-05       61.1258   3.535e-07       0.001      307  LS failed, Hessian reset 
     199       1045.09   1.20349e-07        45.161      0.0243           1      330   
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
     264       1045.71   0.000316932       140.641   3.665e-06       0.001      456  LS failed, Hessian reset 
     292       1045.82   5.70302e-05       48.9256   1.155e-06       0.001      533  LS failed, Hessian reset 
     299       1045.82   7.71897e-06       40.8043      0.3543           1      544   
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
     305       1045.82   5.91182e-07       46.3158   2.336e-08       0.001      594  LS failed, Hessian reset 
     317       1045.82   2.63213e-06       51.4268   5.486e-08       0.001      649  LS failed, Hessian reset 
     343       1045.82   1.59952e-05        25.621   2.535e-07       0.001      728  LS failed, Hessian reset 
     353       1045.82   6.70942e-07       31.5639   1.825e-08       0.001      779  LS failed, Hessian reset 
     355       1045.82   3.11455e-08       40.1124     0.08424           1      783   
Optimization terminated normally: 
  Convergence detected: relative gradient magnitude is below tolerance
</code></pre>
<p><img src="/images/timeseries/forecast/002-Prophet-alg_files/002-Prophet-alg_7_1.png" alt="png" /></p>
<h3 id="growthflat">
  growth=&ldquo;flat&rdquo;
  
  <a class="anchor" href="#growthflat">#</a>
  
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># モデルを作成</span>
</span></span><span style="display:flex;"><span>m <span style="color:#f92672">=</span> Prophet(
</span></span><span style="display:flex;"><span>    yearly_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>    weekly_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>    daily_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>    growth<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;flat&#34;</span>,
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>m<span style="color:#f92672">.</span>fit(df)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 将来を予測</span>
</span></span><span style="display:flex;"><span>future <span style="color:#f92672">=</span> m<span style="color:#f92672">.</span>make_future_dataframe(periods<span style="color:#f92672">=</span><span style="color:#ae81ff">90</span>)
</span></span><span style="display:flex;"><span>forecast <span style="color:#f92672">=</span> m<span style="color:#f92672">.</span>predict(future)
</span></span><span style="display:flex;"><span>fig <span style="color:#f92672">=</span> m<span style="color:#f92672">.</span>plot(forecast)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>axvspan(<span style="color:#ae81ff">18627</span>, <span style="color:#ae81ff">18627</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">90</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;coral&#34;</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.4</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;予測期間&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><pre><code>Initial log joint probability = -3.30635
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
       8       725.322    0.00030891     0.0789655       0.955       0.955       14   
Optimization terminated normally: 
  Convergence detected: relative gradient magnitude is below tolerance
</code></pre>
<p><img src="/images/timeseries/forecast/002-Prophet-alg_files/002-Prophet-alg_9_1.png" alt="png" /></p>
<h2 id="季節変化の指定">
  季節変化の指定
  
  <a class="anchor" href="#%e5%ad%a3%e7%af%80%e5%a4%89%e5%8c%96%e3%81%ae%e6%8c%87%e5%ae%9a">#</a>
  
</h2>
<h3 id="seasonalityが全てfalse">
  seasonalityが全てFalse
  
  <a class="anchor" href="#seasonality%e3%81%8c%e5%85%a8%e3%81%a6false">#</a>
  
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># モデルを作成</span>
</span></span><span style="display:flex;"><span>m <span style="color:#f92672">=</span> Prophet(
</span></span><span style="display:flex;"><span>    yearly_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>    weekly_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>    daily_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>    growth<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;linear&#34;</span>,
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>m<span style="color:#f92672">.</span>fit(df)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 将来を予測</span>
</span></span><span style="display:flex;"><span>future <span style="color:#f92672">=</span> m<span style="color:#f92672">.</span>make_future_dataframe(periods<span style="color:#f92672">=</span><span style="color:#ae81ff">90</span>)
</span></span><span style="display:flex;"><span>forecast <span style="color:#f92672">=</span> m<span style="color:#f92672">.</span>predict(future)
</span></span><span style="display:flex;"><span>fig <span style="color:#f92672">=</span> m<span style="color:#f92672">.</span>plot(forecast)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>axvspan(<span style="color:#ae81ff">18627</span>, <span style="color:#ae81ff">18627</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">90</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;coral&#34;</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.4</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;予測期間&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><pre><code>Initial log joint probability = -2.99674
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
      99       1014.78   0.000250992       97.5427       1.468     0.01468      134   
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
     199          1020    0.00045602       60.8104           1           1      268   
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
     208        1020.1   0.000167489       76.8606   1.772e-06       0.001      314  LS failed, Hessian reset 
     299       1020.33   0.000353008       41.1849        2.43       0.243      446   
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
     352       1020.86   8.23232e-05       43.9782   1.438e-06       0.001      586  LS failed, Hessian reset 
     399       1020.99   0.000244078        56.987           1           1      657   
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
     488       1021.04   3.90795e-05       57.3821   6.974e-07       0.001      856  LS failed, Hessian reset 
     499       1021.04   1.23592e-05       41.4144           1           1      876   
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
     510       1021.04   4.89524e-06       59.8544   1.187e-07       0.001      929  LS failed, Hessian reset 
     571       1021.06   1.29427e-06        39.655   2.478e-08       0.001     1071  LS failed, Hessian reset 
     598       1021.07   1.94887e-05       41.0613   3.113e-07       0.001     1157  LS failed, Hessian reset 
     599       1021.07   4.80514e-06       27.1307       0.643       0.643     1158   
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
     645       1021.07   8.81062e-06       74.3981   1.365e-07       0.001     1264  LS failed, Hessian reset 
     660       1021.07   2.61181e-07       41.0723   5.687e-09       0.001     1321  LS failed, Hessian reset 
     661       1021.07    9.2387e-08       26.7092      0.8838      0.8838     1322   
Optimization terminated normally: 
  Convergence detected: relative gradient magnitude is below tolerance
</code></pre>
<p><img src="/images/timeseries/forecast/002-Prophet-alg_files/002-Prophet-alg_11_1.png" alt="png" /></p>
<h3 id="weekly_seasonalitytrue">
  weekly_seasonality=True
  
  <a class="anchor" href="#weekly_seasonalitytrue">#</a>
  
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># モデルを作成</span>
</span></span><span style="display:flex;"><span>m <span style="color:#f92672">=</span> Prophet(
</span></span><span style="display:flex;"><span>    yearly_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>    weekly_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>    daily_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>    growth<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;linear&#34;</span>,
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>m<span style="color:#f92672">.</span>fit(df)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 将来を予測</span>
</span></span><span style="display:flex;"><span>future <span style="color:#f92672">=</span> m<span style="color:#f92672">.</span>make_future_dataframe(periods<span style="color:#f92672">=</span><span style="color:#ae81ff">90</span>)
</span></span><span style="display:flex;"><span>forecast <span style="color:#f92672">=</span> m<span style="color:#f92672">.</span>predict(future)
</span></span><span style="display:flex;"><span>fig <span style="color:#f92672">=</span> m<span style="color:#f92672">.</span>plot(forecast)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>axvspan(<span style="color:#ae81ff">18627</span>, <span style="color:#ae81ff">18627</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">90</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;coral&#34;</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.4</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;予測期間&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><pre><code>Initial log joint probability = -2.99674
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
      99       1040.17   0.000845008       95.4398      0.3546      0.3546      128   
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
     166       1045.08   8.28451e-05       66.0092   1.087e-06       0.001      252  LS failed, Hessian reset 
     184       1045.09   1.58284e-05       61.1258   3.535e-07       0.001      307  LS failed, Hessian reset 
     199       1045.09   1.20349e-07        45.161      0.0243           1      330   
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
     264       1045.71   0.000316932       140.641   3.665e-06       0.001      456  LS failed, Hessian reset 
     292       1045.82   5.70302e-05       48.9256   1.155e-06       0.001      533  LS failed, Hessian reset 
     299       1045.82   7.71897e-06       40.8043      0.3543           1      544   
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
     305       1045.82   5.91182e-07       46.3158   2.336e-08       0.001      594  LS failed, Hessian reset 
     317       1045.82   2.63213e-06       51.4268   5.486e-08       0.001      649  LS failed, Hessian reset 
     343       1045.82   1.59952e-05        25.621   2.535e-07       0.001      728  LS failed, Hessian reset 
     353       1045.82   6.70942e-07       31.5639   1.825e-08       0.001      779  LS failed, Hessian reset 
     355       1045.82   3.11455e-08       40.1124     0.08424           1      783   
Optimization terminated normally: 
  Convergence detected: relative gradient magnitude is below tolerance
</code></pre>
<p><img src="/images/timeseries/forecast/002-Prophet-alg_files/002-Prophet-alg_13_1.png" alt="png" /></p>
<h3 id="yearly_seasonalitytrue">
  yearly_seasonality=True
  
  <a class="anchor" href="#yearly_seasonalitytrue">#</a>
  
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># モデルを作成</span>
</span></span><span style="display:flex;"><span>m <span style="color:#f92672">=</span> Prophet(
</span></span><span style="display:flex;"><span>    yearly_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>    weekly_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>    daily_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>    growth<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;linear&#34;</span>,
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>m<span style="color:#f92672">.</span>fit(df)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 将来を予測</span>
</span></span><span style="display:flex;"><span>future <span style="color:#f92672">=</span> m<span style="color:#f92672">.</span>make_future_dataframe(periods<span style="color:#f92672">=</span><span style="color:#ae81ff">90</span>)
</span></span><span style="display:flex;"><span>forecast <span style="color:#f92672">=</span> m<span style="color:#f92672">.</span>predict(future)
</span></span><span style="display:flex;"><span>fig <span style="color:#f92672">=</span> m<span style="color:#f92672">.</span>plot(forecast)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>axvspan(<span style="color:#ae81ff">18627</span>, <span style="color:#ae81ff">18627</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">90</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;coral&#34;</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.4</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;予測期間&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><pre><code>Initial log joint probability = -2.99674
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
      99       1076.96   1.35095e-06        94.027      0.3775      0.3775      136   
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
     125       1076.96   2.65686e-06        89.152   2.895e-08       0.001      203  LS failed, Hessian reset 
     164       1076.96   2.28191e-08       91.6592      0.4114      0.4114      258   
Optimization terminated normally: 
  Convergence detected: relative gradient magnitude is below tolerance
</code></pre>
<p><img src="/images/timeseries/forecast/002-Prophet-alg_files/002-Prophet-alg_15_1.png" alt="png" /></p>
<h2 id="休日イベント効果">
  休日・イベント効果
  
  <a class="anchor" href="#%e4%bc%91%e6%97%a5%e3%82%a4%e3%83%99%e3%83%b3%e3%83%88%e5%8a%b9%e6%9e%9c">#</a>
  
</h2>
<h3 id="休日イベントの指定なしholidaysnone">
  休日・イベントの指定なし(<code>holidays=None</code>)
  
  <a class="anchor" href="#%e4%bc%91%e6%97%a5%e3%82%a4%e3%83%99%e3%83%b3%e3%83%88%e3%81%ae%e6%8c%87%e5%ae%9a%e3%81%aa%e3%81%97holidaysnone">#</a>
  
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># モデルを作成</span>
</span></span><span style="display:flex;"><span>m <span style="color:#f92672">=</span> Prophet(
</span></span><span style="display:flex;"><span>    yearly_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>    weekly_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>    daily_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>    growth<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;linear&#34;</span>,
</span></span><span style="display:flex;"><span>    holidays<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>,  <span style="color:#75715e"># 休日・イベントの指定なし</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>m<span style="color:#f92672">.</span>fit(df)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 将来を予測</span>
</span></span><span style="display:flex;"><span>future <span style="color:#f92672">=</span> m<span style="color:#f92672">.</span>make_future_dataframe(periods<span style="color:#f92672">=</span><span style="color:#ae81ff">90</span>)
</span></span><span style="display:flex;"><span>forecast <span style="color:#f92672">=</span> m<span style="color:#f92672">.</span>predict(future)
</span></span><span style="display:flex;"><span>fig <span style="color:#f92672">=</span> m<span style="color:#f92672">.</span>plot(forecast)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>axvspan(<span style="color:#ae81ff">18627</span>, <span style="color:#ae81ff">18627</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">90</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;coral&#34;</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.4</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;予測期間&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><pre><code>Initial log joint probability = -2.99674
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
      99       1040.17   0.000845008       95.4398      0.3546      0.3546      128   
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
     166       1045.08   8.28451e-05       66.0092   1.087e-06       0.001      252  LS failed, Hessian reset 
     184       1045.09   1.58284e-05       61.1258   3.535e-07       0.001      307  LS failed, Hessian reset 
     199       1045.09   1.20349e-07        45.161      0.0243           1      330   
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
     264       1045.71   0.000316932       140.641   3.665e-06       0.001      456  LS failed, Hessian reset 
     292       1045.82   5.70302e-05       48.9256   1.155e-06       0.001      533  LS failed, Hessian reset 
     299       1045.82   7.71897e-06       40.8043      0.3543           1      544   
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
     305       1045.82   5.91182e-07       46.3158   2.336e-08       0.001      594  LS failed, Hessian reset 
     317       1045.82   2.63213e-06       51.4268   5.486e-08       0.001      649  LS failed, Hessian reset 
     343       1045.82   1.59952e-05        25.621   2.535e-07       0.001      728  LS failed, Hessian reset 
     353       1045.82   6.70942e-07       31.5639   1.825e-08       0.001      779  LS failed, Hessian reset 
     355       1045.82   3.11455e-08       40.1124     0.08424           1      783   
Optimization terminated normally: 
  Convergence detected: relative gradient magnitude is below tolerance
</code></pre>
<p><img src="/images/timeseries/forecast/002-Prophet-alg_files/002-Prophet-alg_17_1.png" alt="png" /></p>
<h3 id="休日イベントの指定あり">
  休日・イベントの指定あり
  
  <a class="anchor" href="#%e4%bc%91%e6%97%a5%e3%82%a4%e3%83%99%e3%83%b3%e3%83%88%e3%81%ae%e6%8c%87%e5%ae%9a%e3%81%82%e3%82%8a">#</a>
  
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># モデルを作成</span>
</span></span><span style="display:flex;"><span>df_holidays <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame(
</span></span><span style="display:flex;"><span>    {<span style="color:#e6db74">&#34;holiday&#34;</span>: <span style="color:#e6db74">&#34;event&#34;</span>, <span style="color:#e6db74">&#34;ds&#34;</span>: [di <span style="color:#66d9ef">for</span> i, di <span style="color:#f92672">in</span> enumerate(date) <span style="color:#66d9ef">if</span> i <span style="color:#f92672">in</span> horidays_index]}
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>m <span style="color:#f92672">=</span> Prophet(
</span></span><span style="display:flex;"><span>    yearly_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>    weekly_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>    daily_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>    growth<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;linear&#34;</span>,
</span></span><span style="display:flex;"><span>    holidays<span style="color:#f92672">=</span>df_holidays,  <span style="color:#75715e"># 休日・イベントの指定あり</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>m<span style="color:#f92672">.</span>fit(df)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 将来を予測</span>
</span></span><span style="display:flex;"><span>future <span style="color:#f92672">=</span> m<span style="color:#f92672">.</span>make_future_dataframe(periods<span style="color:#f92672">=</span><span style="color:#ae81ff">90</span>)
</span></span><span style="display:flex;"><span>forecast <span style="color:#f92672">=</span> m<span style="color:#f92672">.</span>predict(future)
</span></span><span style="display:flex;"><span>fig <span style="color:#f92672">=</span> m<span style="color:#f92672">.</span>plot(forecast)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>axvspan(<span style="color:#ae81ff">18627</span>, <span style="color:#ae81ff">18627</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">90</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;coral&#34;</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.4</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;予測期間&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><pre><code>Initial log joint probability = -2.99674
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
      99       1343.59    0.00181622       336.302      0.9914      0.9914      120   
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
     199       1366.61    0.00129331       915.041      0.2388      0.9805      232   
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
     265       1372.99   0.000111116       289.963   4.926e-07       0.001      351  LS failed, Hessian reset 
     299       1374.36    0.00236219       89.8611           1           1      393   
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
     399       1375.61    0.00707432       82.6526           1           1      509   
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
     431       1375.93   8.82293e-05       240.658    4.05e-07       0.001      581  LS failed, Hessian reset 
     453       1376.02   6.12661e-05       95.4391    1.44e-06       0.001      644  LS failed, Hessian reset 
     471       1376.06    1.2062e-05       14.2904   2.239e-07       0.001      709  LS failed, Hessian reset 
     485        1376.1    1.9227e-05       69.5783   2.446e-07       0.001      772  LS failed, Hessian reset 
     493       1376.12   3.43778e-05       51.3583   1.873e-06       0.001      837  LS failed, Hessian reset 
     499       1376.13   2.95479e-05       34.8029      0.5524      0.5524      847   
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
     509       1376.13   8.88412e-06       44.6026   5.452e-07       0.001      897  LS failed, Hessian reset 
     521       1376.14    1.6737e-05       27.0944   1.441e-07       0.001      947  LS failed, Hessian reset 
     531       1376.14   7.82708e-06       47.5548   1.997e-07       0.001     1000  LS failed, Hessian reset 
     567       1376.28   3.47594e-05       113.402   3.767e-07       0.001     1079  LS failed, Hessian reset 
     599       1376.35   0.000359311       95.2959           1           1     1118   
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
     604       1376.35   4.84989e-06        13.344   1.606e-07       0.001     1168  LS failed, Hessian reset 
     612       1376.35   2.91053e-08       12.4075     0.04535           1     1191   
Optimization terminated normally: 
  Convergence detected: relative gradient magnitude is below tolerance
</code></pre>
<p><img src="/images/timeseries/forecast/002-Prophet-alg_files/002-Prophet-alg_19_1.png" alt="png" /></p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>





  
  
  




  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 
      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    

<aside class="book-toc">
  <div class="book-toc-content">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#実験に使用するデータ">実験に使用するデータ</a></li>
    <li><a href="#トレンドの指定">トレンドの指定</a>
      <ul>
        <li><a href="#growthlinear">growth=&ldquo;linear&rdquo;</a></li>
        <li><a href="#growthflat">growth=&ldquo;flat&rdquo;</a></li>
      </ul>
    </li>
    <li><a href="#季節変化の指定">季節変化の指定</a>
      <ul>
        <li><a href="#seasonalityが全てfalse">seasonalityが全てFalse</a></li>
        <li><a href="#weekly_seasonalitytrue">weekly_seasonality=True</a></li>
        <li><a href="#yearly_seasonalitytrue">yearly_seasonality=True</a></li>
      </ul>
    </li>
    <li><a href="#休日イベント効果">休日・イベント効果</a>
      <ul>
        <li><a href="#休日イベントの指定なしholidaysnone">休日・イベントの指定なし(<code>holidays=None</code>)</a></li>
        <li><a href="#休日イベントの指定あり">休日・イベントの指定あり</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </div>
</aside>

 
  </main>

  
</body>
</html>

















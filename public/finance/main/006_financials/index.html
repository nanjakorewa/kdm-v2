<!DOCTYPE html>
<html lang="ja" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="

このページの日英訳は以下のサイトのものを参考しつつ作成していますが、正確性に欠ける可能性があるのであくまで参考程度にお願い致します。
TOMAコンサルタンツグループ株式会社 海外決算書の科目　英語→日本語簡易対訳　損益計算書編


import japanize_matplotlib
import matplotlib.pyplot as plt
import numpy as np
import os
import pandas as pd
import re
import seaborn as sns
from IPython.core.display import display
# 英日辞書
en_US_ja_JP_table = {
    &#34;Revenue&#34;: &#34;売上&#34;,
    &#34;Cost of revenue&#34;: &#34;収益コスト&#34;,
    &#34;Gross profit&#34;: &#34;粗利益&#34;,
    &#34;Sales, General and administrative&#34;: &#34;販売費及び一般管理費&#34;,
    &#34;Other operating expenses&#34;: &#34;その他営業費用&#34;,
    &#34;Total operating expenses&#34;: &#34;営業費用&#34;,
    &#34;Operating income&#34;: &#34;営業利益&#34;,
    &#34;Interest Expense&#34;: &#34;支払利息&#34;,
    &#34;Other income (expense)&#34;: &#34;Other income (expense)&#34;,
    &#34;Income before taxes&#34;: &#34;Income before taxes&#34;,
    &#34;Provision for income taxes&#34;: &#34;Provision for income taxes&#34;,
    &#34;Net income from continuing operations&#34;: &#34;Net income from continuing operations&#34;,
    &#34;Net income available to common shareholders&#34;: &#34;普通株式に係る当期純利益&#34;,
    &#34;Net income&#34;: &#34;当期純利益&#34;,
    &#34;Basic&#34;: &#34;Basic&#34;,
    &#34;Diluted&#34;: &#34;Diluted&#34;,
    &#34;EBITDA&#34;: &#34;EBITDA&#34;,
    &#34;Revenue &#34;: &#34;売上&#34;,
    &#34;Gross Margin %&#34;: &#34;	売上総利益率&#34;,
    &#34;Operating Income &#34;: &#34;営業利益&#34;,
    &#34;Operating Margin %&#34;: &#34;営業利益率&#34;,
    &#34;Net Income &#34;: &#34;純利益&#34;,
    &#34;Earnings Per Share USD&#34;: &#34;EPS (USD)&#34;,
    &#34;Dividends USD&#34;: &#34;配当 (USD)&#34;,
    &#34;Payout Ratio % *&#34;: &#34;配当性向&#34;,
    &#34;Shares Mil&#34;: &#34;株数 (Mil)&#34;,
    &#34;Book Value Per Share * USD&#34;: &#34;1株あたり純資産&#34;,
    &#34;Operating Cash Flow &#34;: &#34;営業キャッシュフロー&#34;,
    &#34;Cap Spending &#34;: &#34;資本的支出&#34;,
    &#34;Free Cash Flow &#34;: &#34;フリーキャッシュフロー（FCF）&#34;,
    &#34;Free Cash Flow Per Share * USD&#34;: &#34;1株あたりFCF&#34;,
    &#34;Working Capital &#34;: &#34;運転資本&#34;,
    &#34;Key Ratios -&gt; Profitability&#34;: &#34;&#34;,
    &#34;Margins % of Sales&#34;: &#34;Margins % of Sales&#34;,
    &#34;COGS&#34;: &#34;売上原価&#34;,
    &#34;Gross Margin&#34;: &#34;売上高総利益率&#34;,
    &#34;SG&amp;A&#34;: &#34;販売費及び一般管理費&#34;,
    &#34;R&amp;D&#34;: &#34;研究開発費&#34;,
    &#34;Operating Margin&#34;: &#34;営業利益率&#34;,
    &#34;Net Int Inc &amp; Other&#34;: &#34;資金運用利益&#43;その他&#34;,
    &#34;EBT Margin&#34;: &#34;EBTマージン&#34;,
    &#34;Debt/Equity&#34;: &#34;負債比率&#34;,
    &#34;Receivables Turnover&#34;: &#34;売上債権回転率&#34;,
    &#34;Inventory Turnover&#34;: &#34;棚卸資産回転率&#34;,
    &#34;Fixed Assets Turnover&#34;: &#34;固定資産回転率&#34;,
    &#34;Asset Turnover&#34;: &#34;総資産回転率&#34;,
    &#34;USD Mil&#34;: &#34;(USD Mil)&#34;,
    &#34;-Year Average&#34;: &#34;年平均&#34;,
}


def get_preprocessed_df(
    filepath,
    is_transpose=True,
    drop_ttm_lastqrt=True,
    ttm_datetime=&#34;2021-12&#34;,
    lastqtr_datetime=&#34;2021-12&#34;,
    add_ticker_column=True,
):
    &#34;&#34;&#34;Morningstar, Incのデータを整形する

    Args:
        filepath (str): ファイルパス
        is_transpose (bool, optional): タイムスタンプ列を縦にするかどうか. Defaults to True.
        drop_ttm_lastqrt (bool, optional): TTM/Last Qrtの記録は削除する. Defaults to True.
        ttm_datetime (str, optional): 「TTM」をどの日付に置き換えるか. Defaults to &#34;2021-12&#34;.
        lastqtr_datetime (str, optional): 「Latest Qtr」をどの日付に置き換えるか. Defaults to &#34;2021-12&#34;.
        add_ticker_column (bool, optional): ticker symbolを示した列を追加するか. Defaults to True.

    Returns:
        DataFrame: 整形済みデータフレーム
    &#34;&#34;&#34;
    df_preprocessed = []
    df_header = []
    row_header = &#34;&#34;
    df = pd.read_table(filepath, header=None)

    if not drop_ttm_lastqrt:
        print(f&#34;[Note] TTM は {ttm_datetime} 、Last Qtrは {lastqtr_datetime} の日付として扱われます。&#34;)

    for idx, row in enumerate(df[0]):
        # 数値中の「,」を置換する
        row = re.sub(&#39;&#34;(-?[0-9]&#43;),&#39;, &#39;&#34;\\1&#39;, row)
        row = re.sub(&#39;,(-?[0-9]&#43;)&#34;,&#39;, &#39;\\1&#34;,&#39;, row)

        # 英語を対応する日本語に置き換える
        for str_en, str_jp in en_US_ja_JP_table.items():
            if str_en in row:
                row = row.replace(str_en, str_jp)

        # TTMがある行はタイムスタンプなのでヘッダー扱いにする
        if &#34;TTM&#34; in row or &#34;Latest Qtr&#34; in row:
            if drop_ttm_lastqrt:
                row = row.replace(&#34;TTM&#34;, &#34;###IGNORE###&#34;)
                row = row.replace(&#34;Latest Qtr&#34;, &#34;###IGNORE###&#34;)
            else:
                assert ttm_datetime not in row, &#34;その日付はすでに存在しています！&#34;
                assert lastqtr_datetime not in row, &#34;その日付はすでに存在しています！&#34;
                row = row.replace(&#34;TTM&#34;, ttm_datetime)
                row = row.replace(&#34;Latest Qtr&#34;, lastqtr_datetime)
            df_header = row.split(&#34;,&#34;)

            if is_transpose:
                df_header[0] = &#34;月&#34;
            else:
                df_header = [&#34;月&#34;] &#43; df_header
            continue

        # 数値に変換できるデータは数値に変換してDataFrameに追加
        if len(row_splited := row.split(&#34;,&#34;)) &gt; 1:
            row_data = [
                float(v) if re.match(r&#34;^-?\d&#43;(?:\.\d&#43;)$&#34;, v) is not None else v
                for v in row_splited
            ]

            if is_transpose:
                row_data[0] = (
                    f&#34;{row_header}/{row_data[0]}&#34; if row_header else f&#34;{row_data[0]}&#34;
                )
            else:
                row_data = [row_header] &#43; row_data
            df_preprocessed.append(row_data)
        else:
            # 先頭の行はファイルのタイトルが入っているので無視
            row_header = f&#34;{row}&#34; if idx &gt; 0 else &#34;&#34;

    # データフレーム作成
    df_preprocessed = pd.DataFrame(df_preprocessed)
    df_preprocessed.columns = df_header
    if drop_ttm_lastqrt:
        df_preprocessed.drop(&#34;###IGNORE###&#34;, axis=1, inplace=True)

    # 不要な文字列を削除
    df_preprocessed.fillna(np.nan, inplace=True)

    if is_transpose:
        df_preprocessed = df_preprocessed.T.reset_index()
        df_preprocessed.columns = df_preprocessed.iloc[0, :]
        df_preprocessed.drop(0, inplace=True)
        df_preprocessed[&#34;月&#34;] = pd.to_datetime(df_preprocessed[&#34;月&#34;])
        for colname in df_preprocessed.columns:
            if colname != &#34;月&#34;:
                df_preprocessed[colname] = pd.to_numeric(
                    df_preprocessed[colname], errors=&#34;coerce&#34;
                )

    if add_ticker_column:
        filename = os.path.basename(filepath)
        ticker_symbol = filename[: filename.index(&#34; &#34;)]
        df_preprocessed[&#34;ticker&#34;] = [
            ticker_symbol for _ in range(df_preprocessed.shape[0])
        ]

    return df_preprocessed

  データを読み込む
  
  #
  

以下の例ではMorningstar, Inc社から提供されているデータを一部引用して使用しています。
このサイトで、指定した企業の財務情報をまとめたcsvファイルを取得します。ここの例ではGolden Ocean Group Ltdなどのデータを使用しています。">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="http://localhost:1313/finance/main/006_financials/">
  <meta property="og:site_name" content="K_DM Book">
  <meta property="og:title" content="企業の財務情報をパース">
  <meta property="og:description" content="このページの日英訳は以下のサイトのものを参考しつつ作成していますが、正確性に欠ける可能性があるのであくまで参考程度にお願い致します。 TOMAコンサルタンツグループ株式会社 海外決算書の科目　英語→日本語簡易対訳　損益計算書編
import japanize_matplotlib import matplotlib.pyplot as plt import numpy as np import os import pandas as pd import re import seaborn as sns from IPython.core.display import display # 英日辞書 en_US_ja_JP_table = { &#34;Revenue&#34;: &#34;売上&#34;, &#34;Cost of revenue&#34;: &#34;収益コスト&#34;, &#34;Gross profit&#34;: &#34;粗利益&#34;, &#34;Sales, General and administrative&#34;: &#34;販売費及び一般管理費&#34;, &#34;Other operating expenses&#34;: &#34;その他営業費用&#34;, &#34;Total operating expenses&#34;: &#34;営業費用&#34;, &#34;Operating income&#34;: &#34;営業利益&#34;, &#34;Interest Expense&#34;: &#34;支払利息&#34;, &#34;Other income (expense)&#34;: &#34;Other income (expense)&#34;, &#34;Income before taxes&#34;: &#34;Income before taxes&#34;, &#34;Provision for income taxes&#34;: &#34;Provision for income taxes&#34;, &#34;Net income from continuing operations&#34;: &#34;Net income from continuing operations&#34;, &#34;Net income available to common shareholders&#34;: &#34;普通株式に係る当期純利益&#34;, &#34;Net income&#34;: &#34;当期純利益&#34;, &#34;Basic&#34;: &#34;Basic&#34;, &#34;Diluted&#34;: &#34;Diluted&#34;, &#34;EBITDA&#34;: &#34;EBITDA&#34;, &#34;Revenue &#34;: &#34;売上&#34;, &#34;Gross Margin %&#34;: &#34;	売上総利益率&#34;, &#34;Operating Income &#34;: &#34;営業利益&#34;, &#34;Operating Margin %&#34;: &#34;営業利益率&#34;, &#34;Net Income &#34;: &#34;純利益&#34;, &#34;Earnings Per Share USD&#34;: &#34;EPS (USD)&#34;, &#34;Dividends USD&#34;: &#34;配当 (USD)&#34;, &#34;Payout Ratio % *&#34;: &#34;配当性向&#34;, &#34;Shares Mil&#34;: &#34;株数 (Mil)&#34;, &#34;Book Value Per Share * USD&#34;: &#34;1株あたり純資産&#34;, &#34;Operating Cash Flow &#34;: &#34;営業キャッシュフロー&#34;, &#34;Cap Spending &#34;: &#34;資本的支出&#34;, &#34;Free Cash Flow &#34;: &#34;フリーキャッシュフロー（FCF）&#34;, &#34;Free Cash Flow Per Share * USD&#34;: &#34;1株あたりFCF&#34;, &#34;Working Capital &#34;: &#34;運転資本&#34;, &#34;Key Ratios -&gt; Profitability&#34;: &#34;&#34;, &#34;Margins % of Sales&#34;: &#34;Margins % of Sales&#34;, &#34;COGS&#34;: &#34;売上原価&#34;, &#34;Gross Margin&#34;: &#34;売上高総利益率&#34;, &#34;SG&amp;A&#34;: &#34;販売費及び一般管理費&#34;, &#34;R&amp;D&#34;: &#34;研究開発費&#34;, &#34;Operating Margin&#34;: &#34;営業利益率&#34;, &#34;Net Int Inc &amp; Other&#34;: &#34;資金運用利益&#43;その他&#34;, &#34;EBT Margin&#34;: &#34;EBTマージン&#34;, &#34;Debt/Equity&#34;: &#34;負債比率&#34;, &#34;Receivables Turnover&#34;: &#34;売上債権回転率&#34;, &#34;Inventory Turnover&#34;: &#34;棚卸資産回転率&#34;, &#34;Fixed Assets Turnover&#34;: &#34;固定資産回転率&#34;, &#34;Asset Turnover&#34;: &#34;総資産回転率&#34;, &#34;USD Mil&#34;: &#34;(USD Mil)&#34;, &#34;-Year Average&#34;: &#34;年平均&#34;, } def get_preprocessed_df( filepath, is_transpose=True, drop_ttm_lastqrt=True, ttm_datetime=&#34;2021-12&#34;, lastqtr_datetime=&#34;2021-12&#34;, add_ticker_column=True, ): &#34;&#34;&#34;Morningstar, Incのデータを整形する Args: filepath (str): ファイルパス is_transpose (bool, optional): タイムスタンプ列を縦にするかどうか. Defaults to True. drop_ttm_lastqrt (bool, optional): TTM/Last Qrtの記録は削除する. Defaults to True. ttm_datetime (str, optional): 「TTM」をどの日付に置き換えるか. Defaults to &#34;2021-12&#34;. lastqtr_datetime (str, optional): 「Latest Qtr」をどの日付に置き換えるか. Defaults to &#34;2021-12&#34;. add_ticker_column (bool, optional): ticker symbolを示した列を追加するか. Defaults to True. Returns: DataFrame: 整形済みデータフレーム &#34;&#34;&#34; df_preprocessed = [] df_header = [] row_header = &#34;&#34; df = pd.read_table(filepath, header=None) if not drop_ttm_lastqrt: print(f&#34;[Note] TTM は {ttm_datetime} 、Last Qtrは {lastqtr_datetime} の日付として扱われます。&#34;) for idx, row in enumerate(df[0]): # 数値中の「,」を置換する row = re.sub(&#39;&#34;(-?[0-9]&#43;),&#39;, &#39;&#34;\\1&#39;, row) row = re.sub(&#39;,(-?[0-9]&#43;)&#34;,&#39;, &#39;\\1&#34;,&#39;, row) # 英語を対応する日本語に置き換える for str_en, str_jp in en_US_ja_JP_table.items(): if str_en in row: row = row.replace(str_en, str_jp) # TTMがある行はタイムスタンプなのでヘッダー扱いにする if &#34;TTM&#34; in row or &#34;Latest Qtr&#34; in row: if drop_ttm_lastqrt: row = row.replace(&#34;TTM&#34;, &#34;###IGNORE###&#34;) row = row.replace(&#34;Latest Qtr&#34;, &#34;###IGNORE###&#34;) else: assert ttm_datetime not in row, &#34;その日付はすでに存在しています！&#34; assert lastqtr_datetime not in row, &#34;その日付はすでに存在しています！&#34; row = row.replace(&#34;TTM&#34;, ttm_datetime) row = row.replace(&#34;Latest Qtr&#34;, lastqtr_datetime) df_header = row.split(&#34;,&#34;) if is_transpose: df_header[0] = &#34;月&#34; else: df_header = [&#34;月&#34;] &#43; df_header continue # 数値に変換できるデータは数値に変換してDataFrameに追加 if len(row_splited := row.split(&#34;,&#34;)) &gt; 1: row_data = [ float(v) if re.match(r&#34;^-?\d&#43;(?:\.\d&#43;)$&#34;, v) is not None else v for v in row_splited ] if is_transpose: row_data[0] = ( f&#34;{row_header}/{row_data[0]}&#34; if row_header else f&#34;{row_data[0]}&#34; ) else: row_data = [row_header] &#43; row_data df_preprocessed.append(row_data) else: # 先頭の行はファイルのタイトルが入っているので無視 row_header = f&#34;{row}&#34; if idx &gt; 0 else &#34;&#34; # データフレーム作成 df_preprocessed = pd.DataFrame(df_preprocessed) df_preprocessed.columns = df_header if drop_ttm_lastqrt: df_preprocessed.drop(&#34;###IGNORE###&#34;, axis=1, inplace=True) # 不要な文字列を削除 df_preprocessed.fillna(np.nan, inplace=True) if is_transpose: df_preprocessed = df_preprocessed.T.reset_index() df_preprocessed.columns = df_preprocessed.iloc[0, :] df_preprocessed.drop(0, inplace=True) df_preprocessed[&#34;月&#34;] = pd.to_datetime(df_preprocessed[&#34;月&#34;]) for colname in df_preprocessed.columns: if colname != &#34;月&#34;: df_preprocessed[colname] = pd.to_numeric( df_preprocessed[colname], errors=&#34;coerce&#34; ) if add_ticker_column: filename = os.path.basename(filepath) ticker_symbol = filename[: filename.index(&#34; &#34;)] df_preprocessed[&#34;ticker&#34;] = [ ticker_symbol for _ in range(df_preprocessed.shape[0]) ] return df_preprocessed データを読み込む # 以下の例ではMorningstar, Inc社から提供されているデータを一部引用して使用しています。 このサイトで、指定した企業の財務情報をまとめたcsvファイルを取得します。ここの例ではGolden Ocean Group Ltdなどのデータを使用しています。">
  <meta property="og:locale" content="ja">
  <meta property="og:type" content="article">
    <meta property="article:section" content="finance">
<title>企業の財務情報をパース | K_DM Book</title>
<link rel="icon" href="/favicon.png" >
<link rel="manifest" href="/manifest.json">
<link rel="canonical" href="http://localhost:1313/finance/main/006_financials/">
<link rel="stylesheet" href="/book.min.5c80a20e1f11b0e9dc4cae70ce44083860ffa999a7bf8ab5dab38664fde8a418.css" integrity="sha256-XICiDh8RsOncTK5wzkQIOGD/qZmnv4q12rOGZP3opBg=" crossorigin="anonymous">
  <script defer src="/fuse.min.js"></script>
  <script defer src="/ja.search.min.58d3a47dfc146864a58893dc5fc3dea0c3290cbd2695f142a0697316f5b64e98.js" integrity="sha256-WNOkffwUaGSliJPcX8PeoMMpDL0mlfFCoGlzFvW2Tpg=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr" class="book-kind-page book-type-finance">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    
<aside class="book-menu">
  <div class="book-menu-content">
    
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>K_DM Book</span>
  </a>
</h2>


<div class="book-search hidden">
  <input type="text" id="book-search-input" placeholder="検索" aria-label="検索" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>



  



  
    
  
    
  
    
  



<ul class="book-languages">
  <li>
    <input type="checkbox" id="languages" class="toggle" />
    <label for="languages" class="flex">
      <a role="button" class="flex flex-auto">
        <img src="/svg/translate.svg" class="book-icon" alt="Languages" />
        <span>日本語</span>
      </a>
    </label>

    <ul>
      
      <li>
        <a href="/en/">
          <span>English</span>
        </a>
      </li>
      
      <li>
        <a href="/es/">
          <span>Español</span>
        </a>
      </li>
      
      <li>
        <a href="/id/">
          <span>Indonesia</span>
        </a>
      </li>
      
    </ul>
  </li>
</ul>














  
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/basic/regression/" class="">線形回帰</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/basic/regression/linear_regression/" class="">最小二乗法</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/regression/ridge_and_lasso/" class="">リッジ回帰・ラッソ回帰</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/regression/robust_regression/" class="">外れ値と頑健性</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/regression/regressionanalysis/" class="">残差の分析</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/classification/" class="">線形分類</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/basic/classification/logistic_regression/" class="">ロジスティック回帰</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/classification/linear_discriminant_analysis/" class="">判別分析</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/tree/" class="">決定木</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/basic/tree/decision_tree_classifier/" class="">決定木(分類)</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/tree/decision_tree_regressor/" class="">決定木(回帰)</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/tree/parameter/" class="">決定木のパラメータ</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/tree/rulefit/" class="">RuleFit</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/ensemble/" class="">アンサンブル</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/basic/ensemble/randomforest/" class="">ランダムフォレスト</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/ensemble/stucking/" class="">スタッキング</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/ensemble/adaboost_classification/" class="">Adaboost(分類)</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/ensemble/adaboost_regression/" class="">Adaboost(回帰)</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/ensemble/gradient_boosting1/" class="">勾配ブースティング</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/ensemble/gradient_boosting2/" class="">勾配ブースティングの可視化</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/clustering/" class="">クラスタリング</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/basic/clustering/k-means1/" class="">k-means</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/clustering/k-means2/" class="">k-means&#43;&#43;</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/clustering/x-means/" class="">X-means</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/dimensionality_reduction/" class="">次元削減</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/basic/dimensionality_reduction/pca/" class="">PCA</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/dimensionality_reduction/svd/" class="">SVD</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/dimensionality_reduction/lda/" class="">LDA</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/dimensionality_reduction/kernel-pca/" class="">Kernel-PCA</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/feature_selection/" class="">特徴選択</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/basic/feature_selection/boruta/" class="">Boruta</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/timeseries/" class="">時系列</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/basic/timeseries/prophet/" class="">Prophetを使ってみる</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/anomaly/" class="">異常検知</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/basic/anomaly/adtk1/" class="">異常検知①</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/basic/anomaly/adtk2/" class="">異常検知②</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>














</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>



  </div>
</aside>
 

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>企業の財務情報をパース</h3>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#データを読み込む">データを読み込む</a></li>
    <li><a href="#変化を可視化する">変化を可視化する</a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><!-- raw HTML omitted -->

<div class="notices ref" ><p>このページの日英訳は以下のサイトのものを参考しつつ作成していますが、正確性に欠ける可能性があるのであくまで参考程度にお願い致します。
<a href="https://toma.co.jp/blog/overseas/%e6%b5%b7%e5%a4%96%e6%b1%ba%e7%ae%97%e6%9b%b8%e3%81%ae%e7%a7%91%e7%9b%ae%e3%80%80%e8%8b%b1%e8%aa%9e%e2%86%92%e6%97%a5%e6%9c%ac%e8%aa%9e%e7%b0%a1%e6%98%93%e5%af%be%e8%a8%b3%e3%80%80%e6%90%8d%e7%9b%8a/">TOMAコンサルタンツグループ株式会社 海外決算書の科目　英語→日本語簡易対訳　損益計算書編</a></p>
</div>

<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> japanize_matplotlib
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> pandas <span style="color:#66d9ef">as</span> pd
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> re
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> seaborn <span style="color:#66d9ef">as</span> sns
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> IPython.core.display <span style="color:#f92672">import</span> display
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 英日辞書</span>
</span></span><span style="display:flex;"><span>en_US_ja_JP_table <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Revenue&#34;</span>: <span style="color:#e6db74">&#34;売上&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Cost of revenue&#34;</span>: <span style="color:#e6db74">&#34;収益コスト&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Gross profit&#34;</span>: <span style="color:#e6db74">&#34;粗利益&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Sales, General and administrative&#34;</span>: <span style="color:#e6db74">&#34;販売費及び一般管理費&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Other operating expenses&#34;</span>: <span style="color:#e6db74">&#34;その他営業費用&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Total operating expenses&#34;</span>: <span style="color:#e6db74">&#34;営業費用&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Operating income&#34;</span>: <span style="color:#e6db74">&#34;営業利益&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Interest Expense&#34;</span>: <span style="color:#e6db74">&#34;支払利息&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Other income (expense)&#34;</span>: <span style="color:#e6db74">&#34;Other income (expense)&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Income before taxes&#34;</span>: <span style="color:#e6db74">&#34;Income before taxes&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Provision for income taxes&#34;</span>: <span style="color:#e6db74">&#34;Provision for income taxes&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Net income from continuing operations&#34;</span>: <span style="color:#e6db74">&#34;Net income from continuing operations&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Net income available to common shareholders&#34;</span>: <span style="color:#e6db74">&#34;普通株式に係る当期純利益&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Net income&#34;</span>: <span style="color:#e6db74">&#34;当期純利益&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Basic&#34;</span>: <span style="color:#e6db74">&#34;Basic&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Diluted&#34;</span>: <span style="color:#e6db74">&#34;Diluted&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;EBITDA&#34;</span>: <span style="color:#e6db74">&#34;EBITDA&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Revenue &#34;</span>: <span style="color:#e6db74">&#34;売上&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Gross Margin %&#34;</span>: <span style="color:#e6db74">&#34;	売上総利益率&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Operating Income &#34;</span>: <span style="color:#e6db74">&#34;営業利益&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Operating Margin %&#34;</span>: <span style="color:#e6db74">&#34;営業利益率&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Net Income &#34;</span>: <span style="color:#e6db74">&#34;純利益&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Earnings Per Share USD&#34;</span>: <span style="color:#e6db74">&#34;EPS (USD)&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Dividends USD&#34;</span>: <span style="color:#e6db74">&#34;配当 (USD)&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Payout Ratio % *&#34;</span>: <span style="color:#e6db74">&#34;配当性向&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Shares Mil&#34;</span>: <span style="color:#e6db74">&#34;株数 (Mil)&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Book Value Per Share * USD&#34;</span>: <span style="color:#e6db74">&#34;1株あたり純資産&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Operating Cash Flow &#34;</span>: <span style="color:#e6db74">&#34;営業キャッシュフロー&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Cap Spending &#34;</span>: <span style="color:#e6db74">&#34;資本的支出&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Free Cash Flow &#34;</span>: <span style="color:#e6db74">&#34;フリーキャッシュフロー（FCF）&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Free Cash Flow Per Share * USD&#34;</span>: <span style="color:#e6db74">&#34;1株あたりFCF&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Working Capital &#34;</span>: <span style="color:#e6db74">&#34;運転資本&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Key Ratios -&gt; Profitability&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Margins </span><span style="color:#e6db74">% o</span><span style="color:#e6db74">f Sales&#34;</span>: <span style="color:#e6db74">&#34;Margins </span><span style="color:#e6db74">% o</span><span style="color:#e6db74">f Sales&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;COGS&#34;</span>: <span style="color:#e6db74">&#34;売上原価&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Gross Margin&#34;</span>: <span style="color:#e6db74">&#34;売上高総利益率&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;SG&amp;A&#34;</span>: <span style="color:#e6db74">&#34;販売費及び一般管理費&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;R&amp;D&#34;</span>: <span style="color:#e6db74">&#34;研究開発費&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Operating Margin&#34;</span>: <span style="color:#e6db74">&#34;営業利益率&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Net Int Inc &amp; Other&#34;</span>: <span style="color:#e6db74">&#34;資金運用利益+その他&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;EBT Margin&#34;</span>: <span style="color:#e6db74">&#34;EBTマージン&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Debt/Equity&#34;</span>: <span style="color:#e6db74">&#34;負債比率&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Receivables Turnover&#34;</span>: <span style="color:#e6db74">&#34;売上債権回転率&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Inventory Turnover&#34;</span>: <span style="color:#e6db74">&#34;棚卸資産回転率&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Fixed Assets Turnover&#34;</span>: <span style="color:#e6db74">&#34;固定資産回転率&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Asset Turnover&#34;</span>: <span style="color:#e6db74">&#34;総資産回転率&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;USD Mil&#34;</span>: <span style="color:#e6db74">&#34;(USD Mil)&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;-Year Average&#34;</span>: <span style="color:#e6db74">&#34;年平均&#34;</span>,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_preprocessed_df</span>(
</span></span><span style="display:flex;"><span>    filepath,
</span></span><span style="display:flex;"><span>    is_transpose<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>    drop_ttm_lastqrt<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>    ttm_datetime<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;2021-12&#34;</span>,
</span></span><span style="display:flex;"><span>    lastqtr_datetime<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;2021-12&#34;</span>,
</span></span><span style="display:flex;"><span>    add_ticker_column<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Morningstar, Incのデータを整形する
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Args:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        filepath (str): ファイルパス
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        is_transpose (bool, optional): タイムスタンプ列を縦にするかどうか. Defaults to True.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        drop_ttm_lastqrt (bool, optional): TTM/Last Qrtの記録は削除する. Defaults to True.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ttm_datetime (str, optional): 「TTM」をどの日付に置き換えるか. Defaults to &#34;2021-12&#34;.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        lastqtr_datetime (str, optional): 「Latest Qtr」をどの日付に置き換えるか. Defaults to &#34;2021-12&#34;.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        add_ticker_column (bool, optional): ticker symbolを示した列を追加するか. Defaults to True.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Returns:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        DataFrame: 整形済みデータフレーム
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    df_preprocessed <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    df_header <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    row_header <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_table(filepath, header<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> drop_ttm_lastqrt:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;[Note] TTM は </span><span style="color:#e6db74">{</span>ttm_datetime<span style="color:#e6db74">}</span><span style="color:#e6db74"> 、Last Qtrは </span><span style="color:#e6db74">{</span>lastqtr_datetime<span style="color:#e6db74">}</span><span style="color:#e6db74"> の日付として扱われます。&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> idx, row <span style="color:#f92672">in</span> enumerate(df[<span style="color:#ae81ff">0</span>]):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 数値中の「,」を置換する</span>
</span></span><span style="display:flex;"><span>        row <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>sub(<span style="color:#e6db74">&#39;&#34;(-?[0-9]+),&#39;</span>, <span style="color:#e6db74">&#39;&#34;</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">1&#39;</span>, row)
</span></span><span style="display:flex;"><span>        row <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>sub(<span style="color:#e6db74">&#39;,(-?[0-9]+)&#34;,&#39;</span>, <span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">1&#34;,&#39;</span>, row)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 英語を対応する日本語に置き換える</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> str_en, str_jp <span style="color:#f92672">in</span> en_US_ja_JP_table<span style="color:#f92672">.</span>items():
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> str_en <span style="color:#f92672">in</span> row:
</span></span><span style="display:flex;"><span>                row <span style="color:#f92672">=</span> row<span style="color:#f92672">.</span>replace(str_en, str_jp)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># TTMがある行はタイムスタンプなのでヘッダー扱いにする</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;TTM&#34;</span> <span style="color:#f92672">in</span> row <span style="color:#f92672">or</span> <span style="color:#e6db74">&#34;Latest Qtr&#34;</span> <span style="color:#f92672">in</span> row:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> drop_ttm_lastqrt:
</span></span><span style="display:flex;"><span>                row <span style="color:#f92672">=</span> row<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;TTM&#34;</span>, <span style="color:#e6db74">&#34;###IGNORE###&#34;</span>)
</span></span><span style="display:flex;"><span>                row <span style="color:#f92672">=</span> row<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;Latest Qtr&#34;</span>, <span style="color:#e6db74">&#34;###IGNORE###&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">assert</span> ttm_datetime <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> row, <span style="color:#e6db74">&#34;その日付はすでに存在しています！&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">assert</span> lastqtr_datetime <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> row, <span style="color:#e6db74">&#34;その日付はすでに存在しています！&#34;</span>
</span></span><span style="display:flex;"><span>                row <span style="color:#f92672">=</span> row<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;TTM&#34;</span>, ttm_datetime)
</span></span><span style="display:flex;"><span>                row <span style="color:#f92672">=</span> row<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;Latest Qtr&#34;</span>, lastqtr_datetime)
</span></span><span style="display:flex;"><span>            df_header <span style="color:#f92672">=</span> row<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#34;,&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> is_transpose:
</span></span><span style="display:flex;"><span>                df_header[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;月&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                df_header <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;月&#34;</span>] <span style="color:#f92672">+</span> df_header
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 数値に変換できるデータは数値に変換してDataFrameに追加</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> len(row_splited <span style="color:#f92672">:=</span> row<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#34;,&#34;</span>)) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>            row_data <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>                float(v) <span style="color:#66d9ef">if</span> re<span style="color:#f92672">.</span><span style="color:#66d9ef">match</span>(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;^-?\d+(?:\.\d+)$&#34;</span>, v) <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span> <span style="color:#66d9ef">else</span> v
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">for</span> v <span style="color:#f92672">in</span> row_splited
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> is_transpose:
</span></span><span style="display:flex;"><span>                row_data[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> (
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>row_header<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{</span>row_data[<span style="color:#ae81ff">0</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#66d9ef">if</span> row_header <span style="color:#66d9ef">else</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>row_data[<span style="color:#ae81ff">0</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>                )
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                row_data <span style="color:#f92672">=</span> [row_header] <span style="color:#f92672">+</span> row_data
</span></span><span style="display:flex;"><span>            df_preprocessed<span style="color:#f92672">.</span>append(row_data)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 先頭の行はファイルのタイトルが入っているので無視</span>
</span></span><span style="display:flex;"><span>            row_header <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>row<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#66d9ef">if</span> idx <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># データフレーム作成</span>
</span></span><span style="display:flex;"><span>    df_preprocessed <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame(df_preprocessed)
</span></span><span style="display:flex;"><span>    df_preprocessed<span style="color:#f92672">.</span>columns <span style="color:#f92672">=</span> df_header
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> drop_ttm_lastqrt:
</span></span><span style="display:flex;"><span>        df_preprocessed<span style="color:#f92672">.</span>drop(<span style="color:#e6db74">&#34;###IGNORE###&#34;</span>, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 不要な文字列を削除</span>
</span></span><span style="display:flex;"><span>    df_preprocessed<span style="color:#f92672">.</span>fillna(np<span style="color:#f92672">.</span>nan, inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> is_transpose:
</span></span><span style="display:flex;"><span>        df_preprocessed <span style="color:#f92672">=</span> df_preprocessed<span style="color:#f92672">.</span>T<span style="color:#f92672">.</span>reset_index()
</span></span><span style="display:flex;"><span>        df_preprocessed<span style="color:#f92672">.</span>columns <span style="color:#f92672">=</span> df_preprocessed<span style="color:#f92672">.</span>iloc[<span style="color:#ae81ff">0</span>, :]
</span></span><span style="display:flex;"><span>        df_preprocessed<span style="color:#f92672">.</span>drop(<span style="color:#ae81ff">0</span>, inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>        df_preprocessed[<span style="color:#e6db74">&#34;月&#34;</span>] <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>to_datetime(df_preprocessed[<span style="color:#e6db74">&#34;月&#34;</span>])
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> colname <span style="color:#f92672">in</span> df_preprocessed<span style="color:#f92672">.</span>columns:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> colname <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;月&#34;</span>:
</span></span><span style="display:flex;"><span>                df_preprocessed[colname] <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>to_numeric(
</span></span><span style="display:flex;"><span>                    df_preprocessed[colname], errors<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;coerce&#34;</span>
</span></span><span style="display:flex;"><span>                )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> add_ticker_column:
</span></span><span style="display:flex;"><span>        filename <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>basename(filepath)
</span></span><span style="display:flex;"><span>        ticker_symbol <span style="color:#f92672">=</span> filename[: filename<span style="color:#f92672">.</span>index(<span style="color:#e6db74">&#34; &#34;</span>)]
</span></span><span style="display:flex;"><span>        df_preprocessed[<span style="color:#e6db74">&#34;ticker&#34;</span>] <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>            ticker_symbol <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(df_preprocessed<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> df_preprocessed
</span></span></code></pre></div><h2 id="データを読み込む">
  データを読み込む
  
  <a class="anchor" href="#%e3%83%87%e3%83%bc%e3%82%bf%e3%82%92%e8%aa%ad%e3%81%bf%e8%be%bc%e3%82%80">#</a>
  
</h2>
<p>以下の例では<a href="https://www.morningstar.com/">Morningstar, Inc</a>社から提供されているデータを一部引用して使用しています。
このサイトで、指定した企業の財務情報をまとめたcsvファイルを取得します。ここの例では<a href="https://www.morningstar.com/stocks/xnas/gogl/quote">Golden Ocean Group Ltd</a>などのデータを使用しています。</p>
<p><!-- raw HTML omitted -->※あくまで表示例であり正確性は保証しません。万一この情報に基づいて被ったいかなる損害についても一切責任を負い兼ねます。<!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df_is_gogl <span style="color:#f92672">=</span> get_preprocessed_df(<span style="color:#e6db74">&#34;data/GOGL Income Statement.csv&#34;</span>)
</span></span><span style="display:flex;"><span>df_kr_gogl <span style="color:#f92672">=</span> get_preprocessed_df(<span style="color:#e6db74">&#34;data/GOGL Key Ratios.csv&#34;</span>)
</span></span><span style="display:flex;"><span>df_is_zim <span style="color:#f92672">=</span> get_preprocessed_df(<span style="color:#e6db74">&#34;data/ZIM Income Statement.csv&#34;</span>)
</span></span><span style="display:flex;"><span>df_kr_zim <span style="color:#f92672">=</span> get_preprocessed_df(<span style="color:#e6db74">&#34;data/ZIM Key Ratios.csv&#34;</span>)
</span></span><span style="display:flex;"><span>df_is_sblk <span style="color:#f92672">=</span> get_preprocessed_df(<span style="color:#e6db74">&#34;data/SBLK Income Statement.csv&#34;</span>)
</span></span><span style="display:flex;"><span>df_kr_sblk <span style="color:#f92672">=</span> get_preprocessed_df(<span style="color:#e6db74">&#34;data/SBLK Key Ratios.csv&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>df_income_statement <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>concat([df_is_gogl, df_is_sblk, df_is_zim])
</span></span><span style="display:flex;"><span>df_key_ratio <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>concat([df_kr_gogl, df_kr_zim, df_kr_sblk])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>display(df_income_statement<span style="color:#f92672">.</span>head())
</span></span><span style="display:flex;"><span>display(df_key_ratio<span style="color:#f92672">.</span>head())
</span></span></code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h2 id="変化を可視化する">
  変化を可視化する
  
  <a class="anchor" href="#%e5%a4%89%e5%8c%96%e3%82%92%e5%8f%af%e8%a6%96%e5%8c%96%e3%81%99%e3%82%8b">#</a>
  
</h2>
<p>seabornを使ってグラフを作成してみます。</p>

<div class="notices document" ><p><a href="https://seaborn.pydata.org/generated/seaborn.barplot.html">seaborn.barplot</a></p>
</div>

<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">show_barchart</span>(data, x<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;月&#34;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;売上&#34;</span>, hue<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ticker&#34;</span>, is_log_scale<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;バーチャートを表示する
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Args:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        data (pandas.DataFrame): データフレーム
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        x (str, optional): 時間軸. Defaults to &#34;月&#34;.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        y (str, optional): 比較する指標. Defaults to &#34;売上&#34;.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        hue (str, optional): 何基準で比較するか. Defaults to &#34;ticker&#34;.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        is_log_scale (bool, optional): logスケールで表示するかどうか. Defaults to False.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    sns<span style="color:#f92672">.</span>set_theme(style<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;whitegrid&#34;</span>, rc<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#34;figure.figsize&#34;</span>: (<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">4</span>)})
</span></span><span style="display:flex;"><span>    japanize_matplotlib<span style="color:#f92672">.</span>japanize()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    g <span style="color:#f92672">=</span> sns<span style="color:#f92672">.</span>barplot(data<span style="color:#f92672">=</span>data, x<span style="color:#f92672">=</span>x, y<span style="color:#f92672">=</span>y, hue<span style="color:#f92672">=</span>hue)
</span></span><span style="display:flex;"><span>    g<span style="color:#f92672">.</span>set_xticklabels(
</span></span><span style="display:flex;"><span>        [xt<span style="color:#f92672">.</span>get_text()<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#34;-01&#34;</span>)[<span style="color:#ae81ff">0</span>] <span style="color:#66d9ef">for</span> xt <span style="color:#f92672">in</span> g<span style="color:#f92672">.</span>get_xticklabels()]
</span></span><span style="display:flex;"><span>    )  <span style="color:#75715e"># TODO: mdates.DateFormatterで日付を表示するとなぜか日付がずれるのでラベルを直接書き換える</span>
</span></span><span style="display:flex;"><span>    g<span style="color:#f92672">.</span>tick_params(axis<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;x&#34;</span>, rotation<span style="color:#f92672">=</span><span style="color:#ae81ff">90</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> is_log_scale:
</span></span><span style="display:flex;"><span>        g<span style="color:#f92672">.</span>set_yscale(<span style="color:#e6db74">&#34;log&#34;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>legend(loc<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;upper left&#34;</span>, title<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Ticker Name&#34;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>y<span style="color:#e6db74">}</span><span style="color:#e6db74">の比較&#34;</span>, fontsize<span style="color:#f92672">=</span><span style="color:#ae81ff">14</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>show_barchart(df_income_statement, x<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;月&#34;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;売上&#34;</span>, hue<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ticker&#34;</span>)
</span></span><span style="display:flex;"><span>show_barchart(df_income_statement, x<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;月&#34;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Operating expenses/当期純利益&#34;</span>, hue<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ticker&#34;</span>)
</span></span></code></pre></div><p><img src="/images/finance/main/006_financials_files/006_financials_8_0.png" alt="png" /></p>
<p><img src="/images/finance/main/006_financials_files/006_financials_8_1.png" alt="png" /></p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>





  
  
  




  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 
      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    

<aside class="book-toc">
  <div class="book-toc-content">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#データを読み込む">データを読み込む</a></li>
    <li><a href="#変化を可視化する">変化を可視化する</a></li>
  </ul>
</nav>



  </div>
</aside>

 
  </main>

  
</body>
</html>
















